<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Justin Andrew Johnson – how_to_contribute</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Justin Andrew Johnson</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./introduction.html" rel="" target="">
 <span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./earth_economy_devstack.html" rel="" target="">
 <span class="menu-text">earth_economy_devstack</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./projectflow_quickstart.html" rel="" target="">
 <span class="menu-text">projectflow_quickstart</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./hazelbean.html" rel="" target="">
 <span class="menu-text">hazelbean</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./installation.html" rel="" target="">
 <span class="menu-text">installation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./how_to_contribute.html" rel="" target="" aria-current="page">
 <span class="menu-text">how_to_contribute</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./seals.html" rel="" target="">
 <span class="menu-text">seals</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#how-to-contribute" id="toc-how-to-contribute" class="nav-link active" data-scroll-target="#how-to-contribute">How to contribute</a>
  <ul class="collapse">
  <li><a href="#version-management-with-git-github-repository" id="toc-version-management-with-git-github-repository" class="nav-link" data-scroll-target="#version-management-with-git-github-repository">Version management with Git &amp; GitHub repository</a>
  <ul class="collapse">
  <li><a href="#forking" id="toc-forking" class="nav-link" data-scroll-target="#forking">Forking</a></li>
  <li><a href="#pull-requests" id="toc-pull-requests" class="nav-link" data-scroll-target="#pull-requests">Pull requests</a></li>
  <li><a href="#branching" id="toc-branching" class="nav-link" data-scroll-target="#branching">Branching</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="how-to-contribute" class="level1">
<h1>How to contribute</h1>
<section id="version-management-with-git-github-repository" class="level2">
<h2 class="anchored" data-anchor-id="version-management-with-git-github-repository">Version management with Git &amp; GitHub repository</h2>
<p>The Earth Economy Devstack and all of its published article code is available as open source software at GitHub, which not only allows users to download and run the code but also to develop it collaboratively. GitHub is based on the free and open source distributed version control system <strong>git</strong> (<a href="https://git-scm.com/)." class="uri">https://git-scm.com/).</a> <strong>git</strong> allows users to track changes in code development, to work on different code branches and to revert changes to previous code versions, if necessary. Workflows using the version control system <strong>git</strong> can vary and there generally is no ‘right’ or ‘wrong’ in collaborative software development.</p>
<p>There are two different ways to interact with a github repository: 1. making a fork; 2; working on a branch. This section describes both options, however internal members of TEEMs will usually use branches.</p>
<section id="forking" class="level3">
<h3 class="anchored" data-anchor-id="forking">Forking</h3>
<p>However, some basic preferred workflows are outlined in the following.</p>
<p><img src="images/git_workflow.png" class="img-fluid"></p>
<section id="create-a-new-fork-of-the-original-seals-repo" class="level4">
<h4 class="anchored" data-anchor-id="create-a-new-fork-of-the-original-seals-repo">Create a new fork of the original SEALS repo</h4>
<p>Before developing the code it is recommended to create a <a href="https://docs.github.com/en/get-started/quickstart/fork-a-repo">fork</a> of the original SEALS repository. This will create a new code repository at your own GitHub profile, which includes the same code base and visibility settings as the original ‘upstream’ repository. The fork can now be used for - code development or fixes - submitting a pull request to the original SEALS repository.</p>
</section>
<section id="clone-fork-to-your-local-machine" class="level4">
<h4 class="anchored" data-anchor-id="clone-fork-to-your-local-machine">Clone fork to your local machine</h4>
<p>Although GitHub allows for some basic code changes, it is recommended to <a href="https://docs.github.com/en/get-started/quickstart/fork-a-repo#cloning-your-forked-repository">clone</a> the forked repository at your local machine and do code developments using an integrated development environment (IDE), such as <a href="https://code.visualstudio.com/">VS Code</a>. To clone the repository on your local machine via the command line, navigate to the local folder, in which you want to clone the repository, and type</p>
<pre><code>git clone -b &lt;name-of-branch&gt;` &lt;url-to-github-repo&gt; &lt;name-of-local-clone-folder&gt;</code></pre>
<p>For example, if you want to clone the develop branch of your SEALS fork type</p>
<pre><code>git clone -b develop https://github.com/&lt;username/seals_dev seals_develop</code></pre>
<p>Before making any changes, make sure that your fork and/or your local repository are up-to-date with the original SEALS repository. To pull changes from your fork use <code>git pull origin &lt;name-of-branch&gt;</code>. In order to pull the latest changes from the original SEALS repository you can set up a link to the original upstream repository with the command <code>git remote add upstream https://github.com/jandrewjohnson/seals_dev</code>. To pull the latest changes from the develop branch in the original upstream repository use <code>git pull upstream develop</code>.</p>
<p>During code development, any changes or fixes that should go back to the fork and/or the original SEALS repository need to be <a href="https://docs.github.com/en/get-started/quickstart/contributing-to-projects#making-and-pushing-changes">‘staged’</a> and then <a href="https://docs.github.com/en/get-started/quickstart/contributing-to-projects#making-and-pushing-changes">‘commited’</a> with a commit message that succinctly describes the changes. By staging changes, <strong>git</strong> is informed that these changes should become part of the next ‘commit’, which essentially takes a snapshot of all staged changes thus far.</p>
<p>To stage all changes in the current repository use the command <code>git add .</code>. If you only want to stage changes in a certain file use <code>git add &lt;(relative)-path-to-file-in-repo&gt;</code>.</p>
<p>To commit all staged changes use the command <code>git commit -m "a short description of the code changes"</code>.</p>
<p>After committing the changes, they can be pushed to your fork by using <code>git push origin &lt;name-of-branch&gt;</code>.</p>
<p><img src="images/git_branches.png" class="img-fluid"></p>
</section>
</section>
<section id="pull-requests" class="level3">
<h3 class="anchored" data-anchor-id="pull-requests">Pull requests</h3>
<p>In order to propose changes to the original SEALS repository, it is recommended to use <a href="https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/creating-a-pull-request-from-a-fork">pull requests</a>. Pull requests inform other users about your code changes and allow them to review these changes by comparing and highlighting the parts of the code that have have been altered. They also highlight potential <a href="https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/addressing-merge-conflicts/about-merge-conflicts">merge conflicts</a>, which occur when git is trying to merge branches with competing commits within the same parts of the code. Pull requests can be done directly at GitHub by navigating to either the forked repository or the original SEALS repository and by clicking on ‘Pull requests’ and then ‘New pull request’. This will open a new pull request page where changes can be described in more detail and code reviewers can be specfied. Pull requests should be reviewed by at least one of the main code developers.</p>
</section>
<section id="branching" class="level3">
<h3 class="anchored" data-anchor-id="branching">Branching</h3>
<p>Wheter you are working on a Fork or on the seals repository itself, we will organize contributions with branches. On the command line, you can create new code branch by using <code>git branch &lt;name-of-new-branch&gt;</code>. To let git know that you want to switch to and work on the new branch use <code>git checkout &lt;name-of-new-branch&gt;</code>. There are many other graphical user interfaces that help with git commands (so you don’t have to memorize all of the commands), including Github Desktop, Sourcetree and others. We also will use a VS Code plug called GitGraph to manage our repository. To install GitGraph, go the the Extensions left tab in VS Code and search for it. Once installed, you will find a button on the status bar to launch it. Using the gtap_invest_dev repository as an example, it should look like this:</p>
<section id="using-git-graph-to-make-a-change" class="level4">
<h4 class="anchored" data-anchor-id="using-git-graph-to-make-a-change">Using Git Graph to make a change</h4>
<p>Suppose you want to make a change to the <code>hazelbean_dev</code> repository. We will use this example to explain how we use Git Graph to make this contribution. First, let’s take a look at the Git Graph interface.</p>
<p><img src="images/2024-02-02-12-41-04.png" class="img-fluid"></p>
<p>First note the Repo dropdown box indicating we are looking at the hazelbean_dev repo. Here you could switch to other Repos that have been added to your workspace. The next thing to note are the three different branch tages (Blue, Magenta and Green boxes on the Git Graph tree view). These are the three branches that are currently in the hazelbean_dev repository. The blue branch is the <code>main</code> branch, the magenta branch is the <code>develop</code> branch and the green branch is a branch specific to the user and/or the feature. In this case, it is <code>develop_justin</code> branch. The lines and dots indicates the history of how files were edited and then how the different branches were merged back together after an edit. By default, when you clone a repository, you will be on the <code>main</code> branch. To switch to another branch, right-click the tag and select <code>checkout branch</code>. When you do this, the files on your harddrive will be changed by Git to match the status of the branch you just checked out. In the image below, we can see which is the current branch because it has an open-circle dot in the graph and the name is bold. Other things to notice is that after the name of the branch there is the word <code>origin</code>. This indicates that the branch is synced with the remote repository (named origin by convention).</p>
<p>To make a change, you will first want to create your own branch. First, make absolutely certain you currently have checked out the <code>develop</code> branch (unless you know why to do otherwise). We will use <code>main</code> branch only to contain working “releases”. Once <code>develop</code> is checked out, use the Command Pallate (<code>ctrl-shift-p</code>) and search for <code>create branch</code>.</p>
<p><img src="images/2024-02-02-12-50-59.png" class="img-fluid"></p>
<p>Choose the right repository among those loaded in your workspace, hazelbean_dev in this example.</p>
<p><img src="images/2024-02-02-12-52-23.png" class="img-fluid"></p>
<p>Then select it and give the new branch a name, either <code>develop_&lt;your_name&gt;</code> or <code>feature_&lt;your_feature_name&gt;</code>. Below we have created a new feature branch called <code>feature_test</code> branched off of the <code>develop</code> branch. It should look like this</p>
<p><img src="images/2024-02-02-12-59-34.png" class="img-fluid"></p>
<p>You’ll notice that the tag is bold, indicating you have checked it out and it is your current branch. Also notice though that it does not have the tag <code>origin</code> after it, indicating that it is not synced with the remote repository. To sync it, you will need to push it to the remote repository. To do this, right-click the tag and select <code>push branch</code>. This will push the branch to the remote repository and it will be available to other users.</p>
<p>Another way to push the branch is using the Version Control tab in VS Code. Click the Version Control tab on the Lefthand bar. There you will see all of the repos you have loaded into our workspace. For hazelbean_dev, you will see it has a <code>publish branch</code> button. Clicking this will have the same effect as the <code>push branch</code> command in Git Graph.</p>
<p><img src="images/2024-02-02-13-28-31.png" class="img-fluid"></p>
<p>Regardless of how you pushed it to the remote repository, you will now see the branch has the ‘origin’ tag after it, indicating it is synced with the remote repository. It is now also the checked-out branch and so all changes you make will be made to this branch.</p>
<p><img src="images/2024-02-02-13-29-25.png" class="img-fluid"></p>
<p>Now, we’re going to make a small change to the code. In the VS Code file explorer, I will open up file_io.py in the hazelbean module and scroll to the function I want to edit.</p>
<p><img src="images/2024-02-02-13-38-53.png" class="img-fluid"></p>
<p>On lines 778-779, you’ll see VS Code has greyed the variables out indicating they are not used, so I will remove them. Once gone, you’ll see a blue bar on the left side of the editor. This is Git and VS Code indicating to you you made a change. Blue indicates a modification where as green indicates a new addition and red indicates a deletion.</p>
<p><img src="images/2024-02-02-13-40-59.png" class="img-fluid"></p>
<p>To illustrate a new addition, I will add a line at to space out our for loop. Once I do this, you’ll see the green bar on the left side of the editor. In the image you can also see that the file_io.py is now a different color and has an M next to it. This indicates that the file has been modified.</p>
<p><img src="images/2024-02-02-13-42-49.png" class="img-fluid"></p>
<p>Another useful thing you can do is click on the Blue or Green edit bar to see more details, as below.</p>
<p><img src="images/2024-02-02-13-44-07.png" class="img-fluid"></p>
<p>Here, you can see the exact changes you made. Additionally, there are buttons at the top of this new box that let you revert the change to go back to how it was before.</p>
<p>Before we commit our changes, look at the Git Graph view. You’ll see that we now have a new grey line coming from the feature_test branch, showing that we have uncommitted changes. You could click on the uncommitted changes link to see the edits we made.</p>
<p><img src="images/2024-02-02-13-49-34.png" class="img-fluid"></p>
<p>We are now going to commit our changes. To do this, go to the Version Control Tab. You will now see that there is a change listed under the hazelbean_dev repository. Click on the change to see the details. You will see a more detailed “diff editor” that lets you understand (or change) what was edited. To accept these changes, we will click the commit button. But first write a short commit message. Click Commit (but don’t yet click the next button to Sync changes). After committing, look back at the Git Graph view. You’ll see that the grey line is now gone and the blue feature_test tag is at the top of our commit tree along with our comitt message.</p>
<p><img src="images/2024-02-02-13-51-20.png" class="img-fluid"></p>
<p>Notice though that the tag for origin/feature_test is not yet up at the new location. This is because we have not yet pushed our changes to the remote repository. To do this, click the Sync button in the bottom right of the VS Code window. This will push your changes to the remote repository and update the tag to the new location, like this.</p>
<p><img src="images/2024-02-02-13-52-14.png" class="img-fluid"></p>
<p>Your code is now on GitHub and other contributors with access could check it out and try it. But, this code will be different than their code and if you made non-trivial changes, it could be hard to keep straight what is going on. To clarify this, we are going to merge our <code>feature_test</code> branch back into <code>develop</code>.</p>
<p>To do this, first you must make sure you have the most recent version of the <code>develop</code> branch. To do this, first we will use the command palette and search for <code>git pull</code>. This will pull the most recent changes from the remote repository and update your local <code>develop</code> branch. Next, we want to make sure that any changes in <code>develop</code> are merged with what we just did to our <code>feature_test</code> branch. If there were no changes, this is not strictly necessary, but it’s a good precation to take to avoid future merge conflicts. To do this, right click on the <code>develop</code> tag and select <code>merge into current branch</code>. A popup will ask you to confirm this, which you do want to (with the default options).</p>
<p><img src="images/2024-02-02-13-54-50.png" class="img-fluid"></p>
<p>Now that we know for sure we have the most up-to-date develop branch details, we can merge our new feature into the develop branch. However, we will protect the develop branch so that only features that pass unit tests can be merged in. Thus, you will make a pull request, as described above, to get me to merge your work in the develop branch. For completeness, here we discuss how one would to that. To do this, first right-click on the <code>develop</code> tag and select <code>Checkout branch</code>. Our git tree will now show we have <code>develop</code> checked out:</p>
<p><img src="images/paste-42.png" class="img-fluid"></p>
<p>With develop checked out, now right click on <code>feature_test</code> and select <code>merge into current branch</code>. Select confirm in the popup box. Click Sync Changes in the Version Control Tab.</p>
<p><img src="images/paste-43.png" class="img-fluid"></p>
<p>the feature_test and develop branches are now identical. You could now delete feature_test and nothing would be lost. Now, the develop branch is ready for a user to use and/or make new branches off of. # End</p>


</section>
</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>
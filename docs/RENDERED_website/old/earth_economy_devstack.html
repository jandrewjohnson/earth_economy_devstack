<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Justin Andrew Johnson</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Justin Andrew Johnson</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../gtappy.html"> 
<span class="menu-text">gtappy</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../hazelbean.html"> 
<span class="menu-text">hazelbean</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../how_to_contribute.html"> 
<span class="menu-text">how_to_contribute</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">index</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../installation.html"> 
<span class="menu-text">installation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../project_flow.html"> 
<span class="menu-text">project_flow</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../organization.html"> 
<span class="menu-text">organization</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../seals.html"> 
<span class="menu-text">seals</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../conventions.html"> 
<span class="menu-text">conventions</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overall-organization" id="toc-overall-organization" class="nav-link active" data-scroll-target="#overall-organization">Overall Organization</a>
  <ul class="collapse">
  <li><a href="#getting-the-earth_economy_devstack-repository" id="toc-getting-the-earth_economy_devstack-repository" class="nav-link" data-scroll-target="#getting-the-earth_economy_devstack-repository">Getting the earth_economy_devstack repository</a></li>
  <li><a href="#get-the-other-repositories" id="toc-get-the-other-repositories" class="nav-link" data-scroll-target="#get-the-other-repositories">Get the other repositories</a></li>
  <li><a href="#launching-the-devstack-in-vs-code" id="toc-launching-the-devstack-in-vs-code" class="nav-link" data-scroll-target="#launching-the-devstack-in-vs-code">Launching the devstack in VS Code</a></li>
  <li><a href="#launch-and-vs-code-configurations" id="toc-launch-and-vs-code-configurations" class="nav-link" data-scroll-target="#launch-and-vs-code-configurations">Launch and VS Code Configurations</a></li>
  </ul></li>
  <li><a href="#how-to-contribute" id="toc-how-to-contribute" class="nav-link" data-scroll-target="#how-to-contribute">How to contribute</a>
  <ul class="collapse">
  <li><a href="#version-management-with-git-github-repository" id="toc-version-management-with-git-github-repository" class="nav-link" data-scroll-target="#version-management-with-git-github-repository">Version management with Git &amp; GitHub repository</a>
  <ul class="collapse">
  <li><a href="#forking" id="toc-forking" class="nav-link" data-scroll-target="#forking">Forking</a></li>
  <li><a href="#branching" id="toc-branching" class="nav-link" data-scroll-target="#branching">Branching</a></li>
  </ul></li>
  <li><a href="#iterating-over-many-model-assumptions" id="toc-iterating-over-many-model-assumptions" class="nav-link" data-scroll-target="#iterating-over-many-model-assumptions">Iterating over many model assumptions</a></li>
  <li><a href="#creating-scenarios-spreadsheets" id="toc-creating-scenarios-spreadsheets" class="nav-link" data-scroll-target="#creating-scenarios-spreadsheets">Creating scenarios spreadsheets</a></li>
  <li><a href="#task-format" id="toc-task-format" class="nav-link" data-scroll-target="#task-format">Task Format</a></li>
  <li><a href="#automatic-directory-organization-via-tasks" id="toc-automatic-directory-organization-via-tasks" class="nav-link" data-scroll-target="#automatic-directory-organization-via-tasks">Automatic Directory Organization via Tasks</a></li>
  <li><a href="#validation-of-files" id="toc-validation-of-files" class="nav-link" data-scroll-target="#validation-of-files">Validation of files</a>
  <ul class="collapse">
  <li><a href="#eliminating-redundant-calculation-across-projects" id="toc-eliminating-redundant-calculation-across-projects" class="nav-link" data-scroll-target="#eliminating-redundant-calculation-across-projects">Eliminating redundant calculation across projects</a></li>
  <li><a href="#python-tips-and-conventions" id="toc-python-tips-and-conventions" class="nav-link" data-scroll-target="#python-tips-and-conventions">Python Tips and Conventions</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#python-installation" id="toc-python-installation" class="nav-link" data-scroll-target="#python-installation">Python Installation</a></li>
  <li><a href="#hazelbean" id="toc-hazelbean" class="nav-link" data-scroll-target="#hazelbean">Hazelbean</a>
  <ul class="collapse">
  <li><a href="#quickstart" id="toc-quickstart" class="nav-link" data-scroll-target="#quickstart">Quickstart</a></li>
  <li><a href="#library-of-useful-functions" id="toc-library-of-useful-functions" class="nav-link" data-scroll-target="#library-of-useful-functions">Library of useful functions</a></li>
  <li><a href="#project-flow" id="toc-project-flow" class="nav-link" data-scroll-target="#project-flow">Project Flow</a>
  <ul class="collapse">
  <li><a href="#project-flow-notes" id="toc-project-flow-notes" class="nav-link" data-scroll-target="#project-flow-notes">Project Flow notes</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#gtappy" id="toc-gtappy" class="nav-link" data-scroll-target="#gtappy">GTAPPy</a>
  <ul class="collapse">
  <li><a href="#installation" id="toc-installation" class="nav-link" data-scroll-target="#installation">Installation</a>
  <ul class="collapse">
  <li><a href="#cython-installation" id="toc-cython-installation" class="nav-link" data-scroll-target="#cython-installation">Cython Installation</a></li>
  <li><a href="#run-gtap-installation-simple-for-class" id="toc-run-gtap-installation-simple-for-class" class="nav-link" data-scroll-target="#run-gtap-installation-simple-for-class">Run-GTAP installation simple for class</a></li>
  </ul></li>
  <li><a href="#cgtpag2aggstoregtap10a_gtap_2014_65x141gtapv7" id="toc-cgtpag2aggstoregtap10a_gtap_2014_65x141gtapv7" class="nav-link" data-scroll-target="#cgtpag2aggstoregtap10a_gtap_2014_65x141gtapv7"><code>C:\\GTPAg2\\AggStore\\GTAP10A_GTAP_2014_65x141\\gtapv7</code></a></li>
  <li><a href="#iterating-over-multiple-aggregations" id="toc-iterating-over-multiple-aggregations" class="nav-link" data-scroll-target="#iterating-over-multiple-aggregations">Iterating over multiple aggregations</a></li>
  <li><a href="#release-notes" id="toc-release-notes" class="nav-link" data-scroll-target="#release-notes">Release notes</a>
  <ul class="collapse">
  <li><a href="#v2023-12-18" id="toc-v2023-12-18" class="nav-link" data-scroll-target="#v2023-12-18">v2023-12-18</a></li>
  <li><a href="#v2023-12-15" id="toc-v2023-12-15" class="nav-link" data-scroll-target="#v2023-12-15">v2023-12-15</a></li>
  <li><a href="#v2023-11-01" id="toc-v2023-11-01" class="nav-link" data-scroll-target="#v2023-11-01">v2023-11-01</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#seals" id="toc-seals" class="nav-link" data-scroll-target="#seals">SEALS</a>
  <ul class="collapse">
  <li><a href="#from-readme-might-be-redundant" id="toc-from-readme-might-be-redundant" class="nav-link" data-scroll-target="#from-readme-might-be-redundant">From Readme (might be redundant)</a></li>
  <li><a href="#release-notes-1" id="toc-release-notes-1" class="nav-link" data-scroll-target="#release-notes-1">Release Notes</a>
  <ul class="collapse">
  <li><a href="#update-v0.5.0" id="toc-update-v0.5.0" class="nav-link" data-scroll-target="#update-v0.5.0">Update v0.5.0</a></li>
  <li><a href="#update-v0.4.0" id="toc-update-v0.4.0" class="nav-link" data-scroll-target="#update-v0.4.0">Update v0.4.0</a></li>
  </ul></li>
  <li><a href="#numpy-errors" id="toc-numpy-errors" class="nav-link" data-scroll-target="#numpy-errors">Numpy errors</a></li>
  <li><a href="#mac-specific-errors" id="toc-mac-specific-errors" class="nav-link" data-scroll-target="#mac-specific-errors">Mac specific errors</a></li>
  <li><a href="#hazelbean-1" id="toc-hazelbean-1" class="nav-link" data-scroll-target="#hazelbean-1">Hazelbean</a></li>
  <li><a href="#project-flow-1" id="toc-project-flow-1" class="nav-link" data-scroll-target="#project-flow-1">Project Flow</a></li>
  <li><a href="#first-run-walkthrough-tutorial" id="toc-first-run-walkthrough-tutorial" class="nav-link" data-scroll-target="#first-run-walkthrough-tutorial">First run walkthrough tutorial</a></li>
  <li><a href="#running-the-model" id="toc-running-the-model" class="nav-link" data-scroll-target="#running-the-model">Running the model</a></li>
  <li><a href="#more-seals-details" id="toc-more-seals-details" class="nav-link" data-scroll-target="#more-seals-details">More SEALS details</a>
  <ul class="collapse">
  <li><a href="#linking-paths" id="toc-linking-paths" class="nav-link" data-scroll-target="#linking-paths">Linking paths</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#global-invest" id="toc-global-invest" class="nav-link" data-scroll-target="#global-invest">Global InVEST</a></li>
  <li><a href="#gtap-invest" id="toc-gtap-invest" class="nav-link" data-scroll-target="#gtap-invest">GTAP-InVEST</a></li>
  <li><a href="#naming-conventions" id="toc-naming-conventions" class="nav-link" data-scroll-target="#naming-conventions">Naming conventions</a>
  <ul class="collapse">
  <li><a href="#id-index-label-name-description" id="toc-id-index-label-name-description" class="nav-link" data-scroll-target="#id-index-label-name-description">Id, index, label, name, description</a></li>
  <li><a href="#id-index-etc.-in-the-context-of-vector-data" id="toc-id-index-etc.-in-the-context-of-vector-data" class="nav-link" data-scroll-target="#id-index-etc.-in-the-context-of-vector-data">Id, Index etc. in the context of vector data</a></li>
  <li><a href="#labels-files" id="toc-labels-files" class="nav-link" data-scroll-target="#labels-files">Labels files</a></li>
  <li><a href="#correspondences" id="toc-correspondences" class="nav-link" data-scroll-target="#correspondences">Correspondences</a></li>
  <li><a href="#combined-ids" id="toc-combined-ids" class="nav-link" data-scroll-target="#combined-ids">Combined ids</a></li>
  <li><a href="#correspondences-with-geometries" id="toc-correspondences-with-geometries" class="nav-link" data-scroll-target="#correspondences-with-geometries">Correspondences with geometries</a></li>
  <li><a href="#more-on-naming-conventions" id="toc-more-on-naming-conventions" class="nav-link" data-scroll-target="#more-on-naming-conventions">More on naming Conventions</a></li>
  <li><a href="#variable-and-scenario-naming-conventions" id="toc-variable-and-scenario-naming-conventions" class="nav-link" data-scroll-target="#variable-and-scenario-naming-conventions">Variable and Scenario Naming Conventions</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">DEPRACATED - SEE INDIVIDUAL FILES - Earth-Economy Devstack</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This is the documentation for the Earth-Economy Devstack, which is the set of repositories and code tools used by the Johnson-Polasky Lab and NatCap TEEMs. This documentation starts with overall organization of the Earth-Economy Devstack and discusses common coding practices used among the 5 underlying repositories. Next, each of the repositories is discussed in turn.</p>
<section id="overall-organization" class="level1">
<h1>Overall Organization</h1>
<section id="getting-the-earth_economy_devstack-repository" class="level2">
<h2 class="anchored" data-anchor-id="getting-the-earth_economy_devstack-repository">Getting the earth_economy_devstack repository</h2>
<p>Assuming you have already setup your python environment and installed VS Code, the first step is to clone all of the relevant repositories into the exact-right location. Throughout this documentation, we refer to “EE Spec”, or Earth-Economy Specification. This is simply the common conventions for things like naming files and organizing them so that it works for all participants. The EE Spec organization is to clone the <code>earth_economy_devstack</code> repository, available at <a href="https://github.com/jandrewjohnson/earth_economy_devstack" class="uri">https://github.com/jandrewjohnson/earth_economy_devstack</a>, into your Users directory in a subdirectory called Files. The PC version is shown below.</p>
<p><img src="images/paste-23.png" class="img-fluid"></p>
<p>To clone here, you can use the command line, navigate to the Files directory and use <code>git clone https://github.com/jandrewjohnson/earth_economy_devstack</code> . Alternatively you could use VS Code’s Command Pallate &lt;ctrl-shift-s&gt; Git Clone command and navigate to this repo. This repository configures VS Code to work well with the other EE repos and, for instance, defines launch-configurations that will always use the latest from github.</p>
</section>
<section id="get-the-other-repositories" class="level2">
<h2 class="anchored" data-anchor-id="get-the-other-repositories">Get the other repositories</h2>
<p>Next, create a folder for each of the five repositories in the Files directory, as in the picture above.</p>
<ol type="1">
<li>hazelbean</li>
<li>seals</li>
<li>gtappy</li>
<li>gtap_invest</li>
<li>global_invest</li>
</ol>
<p>Inside each of these folders, you will clone the corresponding repositories:</p>
<ol type="1">
<li><a href="https://github.com/jandrewjohnson/hazelbean_dev" class="uri">https://github.com/jandrewjohnson/hazelbean_dev</a></li>
<li><a href="https://github.com/jandrewjohnson/seals_dev" class="uri">https://github.com/jandrewjohnson/seals_dev</a></li>
<li><a href="https://github.com/jandrewjohnson/gtappy_dev" class="uri">https://github.com/jandrewjohnson/gtappy_dev</a></li>
<li><a href="https://github.com/jandrewjohnson/gtap_invest_dev" class="uri">https://github.com/jandrewjohnson/gtap_invest_dev</a></li>
<li><a href="https://github.com/jandrewjohnson/global_invest_dev" class="uri">https://github.com/jandrewjohnson/global_invest_dev</a></li>
</ol>
<p>If successful, you will have a new folder with <code>_dev</code> postpended, indicating that it is the repository itself (and is the dev, i.e., not yet public, version of it). For GTAPPy it should look like this:</p>
<p><img src="images/paste-30.png" class="img-fluid"></p>
<p>All code will be stored in the _dev repository. All files that you will generate when running the libraries, conversely, will be in a different Projects directory as above (This will be discussed more in the ProjectFlow section).</p>
</section>
<section id="launching-the-devstack-in-vs-code" class="level2">
<h2 class="anchored" data-anchor-id="launching-the-devstack-in-vs-code">Launching the devstack in VS Code</h2>
<p>Navigate to the earth_economy_devstack directory. In there, you will find a file <code>earth_economy_devstack.code-workspace</code> (pictured below).</p>
<p><img src="images/paste-31.png" class="img-fluid"></p>
<p>Double click it to load a preconfigured VS Code Workspace. You will know you have it all working if the explorer tab in VS Code shows all all SIX of the repositories.</p>
<p><img src="images/paste-32.png" class="img-fluid"></p>
</section>
<section id="launch-and-vs-code-configurations" class="level2">
<h2 class="anchored" data-anchor-id="launch-and-vs-code-configurations">Launch and VS Code Configurations</h2>
<p>The earth_economy_devstack.code-workspace configures VS Code so that it includes all of the necessary repositories for EE code to run. Specifically, this means that if you pull the most recent version of each repository from Github, your code will all work together seamlessly. In addition to this file, you will see in the .vs_code directory there is a <code>launch.json</code> file. This file defines how to launch the python Debugger so that it uses the correct versions of the repositories. To launch a specific python file, first make it the active editor window, then open the debugger tab in VS Code’s left navbar, and in the Run and Debug dropdown box (pictured below) select the first run configuration, then hit the green Play triangle to launch the python file you had open. If all is setup correctly, your file you ran should be able to import all of the libraries in the devstack.</p>
<p><img src="images/paste-34.png" class="img-fluid"></p>
</section>
</section>
<section id="how-to-contribute" class="level1">
<h1>How to contribute</h1>
<section id="version-management-with-git-github-repository" class="level2">
<h2 class="anchored" data-anchor-id="version-management-with-git-github-repository">Version management with Git &amp; GitHub repository</h2>
<p>SEALS is available as open source software at GitHub, which not only allows users to download and run the code but also to develop it collaboratively. GitHub is based on the free and open source distributed version control system <strong>git</strong> (<a href="https://git-scm.com/)." class="uri">https://git-scm.com/).</a> <strong>git</strong> allows users to track changes in code development, to work on different code branches and to revert changes to previous code versions, if necessary. Workflows using the version control system <strong>git</strong> can vary and there generally is no ‘right’ or ‘wrong’ in collaborative software development.</p>
<p>There are two different ways to interact with a github repository: 1. making a fork; 2; working on a branch. This section describes both options, however internal members of TEEMs will usually use branches.</p>
<section id="forking" class="level3">
<h3 class="anchored" data-anchor-id="forking">Forking</h3>
<p>However, some basic preferred workflows are outlined in the following.</p>
<p><img src="images/git_workflow.png" class="img-fluid"></p>
<section id="create-a-new-fork-of-the-original-seals-repo" class="level4">
<h4 class="anchored" data-anchor-id="create-a-new-fork-of-the-original-seals-repo">Create a new fork of the original SEALS repo</h4>
<p>Before developing the code it is recommended to create a <a href="https://docs.github.com/en/get-started/quickstart/fork-a-repo">fork</a> of the original SEALS repository. This will create a new code repository at your own GitHub profile, which includes the same code base and visibility settings as the original ‘upstream’ repository. The fork can now be used for - code development or fixes - submitting a pull request to the original SEALS repository.</p>
</section>
<section id="clone-fork-to-your-local-machine" class="level4">
<h4 class="anchored" data-anchor-id="clone-fork-to-your-local-machine">Clone fork to your local machine</h4>
<p>Although GitHub allows for some basic code changes, it is recommended to <a href="https://docs.github.com/en/get-started/quickstart/fork-a-repo#cloning-your-forked-repository">clone</a> the forked repository at your local machine and do code developments using an integrated development environment (IDE), such as <a href="https://code.visualstudio.com/">VS Code</a>. To clone the repository on your local machine via the command line, navigate to the local folder, in which you want to clone the repository, and type</p>
<pre><code>git clone -b &lt;name-of-branch&gt;` &lt;url-to-github-repo&gt; &lt;name-of-local-clone-folder&gt;</code></pre>
<p>For example, if you want to clone the develop branch of your SEALS fork type</p>
<pre><code>git clone -b develop https://github.com/&lt;username/seals_dev seals_develop</code></pre>
</section>
</section>
<section id="branching" class="level3">
<h3 class="anchored" data-anchor-id="branching">Branching</h3>
<p>Wheter you are working on a Fork or on the seals repository itself, we will organize contributions with branches. On the command line, you can create new code branch by using <code>git branch &lt;name-of-new-branch&gt;</code>. To let git know that you want to switch to and work on the new branch use <code>git checkout &lt;name-of-new-branch&gt;</code>. There are many other graphical user interfaces that help with git commands (so you don’t have to memorize all of the commands), including Github Desktop, Sourcetree and others. We also will use a VS Code plug called GitGraph to manage our repository. To install GitGraph, go the the Extensions left tab in VS Code and search for it. Once installed, you will find a button on the status bar to launch it. Using the gtap_invest_dev repository as an example, it should look like this:</p>
<p><img src="images/2024-01-20-10-05-43.png" class="img-fluid"></p>
<p>This is an example that has multiple branches that add new content, but are then merged back into one.</p>
<p>Before making any changes, make sure that your fork and/or your local repository are up-to-date with the original SEALS repository. To pull changes from your fork use <code>git pull origin &lt;name-of-branch&gt;</code>. In order to pull the latest changes from the original SEALS repository you can set up a link to the original upstream repository with the command <code>git remote add upstream https://github.com/jandrewjohnson/seals_dev</code>. To pull the latest changes from the develop branch in the original upstream repository use <code>git pull upstream develop</code>.</p>
<p>During code development, any changes or fixes that should go back to the fork and/or the original SEALS repository need to be <a href="https://docs.github.com/en/get-started/quickstart/contributing-to-projects#making-and-pushing-changes">‘staged’</a> and then <a href="https://docs.github.com/en/get-started/quickstart/contributing-to-projects#making-and-pushing-changes">‘commited’</a> with a commit message that succinctly describes the changes. By staging changes, <strong>git</strong> is informed that these changes should become part of the next ‘commit’, which essentially takes a snapshot of all staged changes thus far.</p>
<p>To stage all changes in the current repository use the command <code>git add .</code>. If you only want to stage changes in a certain file use <code>git add &lt;(relative)-path-to-file-in-repo&gt;</code>.</p>
<p>To commit all staged changes use the command <code>git commit -m "a short description of the code changes"</code>.</p>
<p>After committing the changes, they can be pushed to your fork by using <code>git push origin &lt;name-of-branch&gt;</code>.</p>
<p><img src="images/git_branches.png" class="img-fluid"> ### Pull requests</p>
<p>In order to propose changes to the original SEALS repository, it is recommended to use <a href="https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/creating-a-pull-request-from-a-fork">pull requests</a>. Pull requests inform other users about your code changes and allow them to review these changes by comparing and highlighting the parts of the code that have have been altered. They also highlight potential <a href="https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/addressing-merge-conflicts/about-merge-conflicts">merge conflicts</a>, which occur when git is trying to merge branches with competing commits within the same parts of the code. Pull requests can be done directly at GitHub by navigating to either the forked repository or the original SEALS repository and by clicking on ‘Pull requests’ and then ‘New pull request’. This will open a new pull request page where changes can be described in more detail and code reviewers can be specfied. Pull requests should be reviewed by at least one of the main code developers.</p>
</section>
</section>
<section id="iterating-over-many-model-assumptions" class="level2">
<h2 class="anchored" data-anchor-id="iterating-over-many-model-assumptions">Iterating over many model assumptions</h2>
<p>In many case, such as a standard GTAPPy run, we will iterate over different aggergations and scenarios (now renamed counterfactuals). This is done as expected with code like this:</p>
<div id="323a9d7e" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> aggregation_label <span class="kw">in</span> p.aggregation_labels:</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> experiment_label <span class="kw">in</span> p.experiment_labels:</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> n_years_counter, ending_year <span class="kw">in</span> <span class="bu">enumerate</span>(p.years):</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> n_years_counter <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                starting_year <span class="op">=</span> p.base_year</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>                starting_year <span class="op">=</span> p.years[n_years_counter <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>            output_dir <span class="op">=</span> p.get_path(os.path.join(aggregation_label, experiment_label, <span class="bu">str</span>(ending_year)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>But sometimes, this becomes DEEPLY nested and confusing. SEALS implements an API that reads these nested layers from a CSV. This is defined more fully in the SEALS user guide.</p>
<div id="4c7aea97" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, row <span class="kw">in</span> p.scenarios_df.iterrows():</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    seals_utils.assign_df_row_to_object_attributes(p, row)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> p.scenario_type <span class="op">!=</span> <span class="st">'baseline'</span>:</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> n_years_counter, ending_year <span class="kw">in</span> <span class="bu">enumerate</span>(p.years):</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> n_years_counter <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                starting_year <span class="op">=</span> p.base_year</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                starting_year <span class="op">=</span> p.years[n_years_counter <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>            current_run_dirs <span class="op">=</span> os.path.join(p.exogenous_label, p.climate_label, p.model_label, p.counterfactual_label)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>            output_dir <span class="op">=</span> p.get_path(current_run_dirs, <span class="bu">str</span>(ending_year))</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>            expected_sl4_path <span class="op">=</span> os.path.join(output_dir, p.counterfactual_label <span class="op">+</span> <span class="st">'_Y'</span> <span class="op">+</span> <span class="bu">str</span>(ending_year) <span class="op">+</span> <span class="st">'.sl4'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this scenarios_df, which was loaded from scenarios_csv_path, there are multiple nested for loops implied, for <code>p.exogenous_label, p.climate_label, p.model_label, p.counterfactual_label</code>, each row has a unique value that would have been iterated over with the for loop above. Now, however, we are iterating just over scenario_df rows. Within each row pass, a project-level attribute is assigned via <code>seals_utils.assign_df_row_to_object_attributes(p, row)</code>. This is used instead of the nested for loop.</p>
</section>
<section id="creating-scenarios-spreadsheets" class="level2">
<h2 class="anchored" data-anchor-id="creating-scenarios-spreadsheets">Creating scenarios spreadsheets</h2>
<p>Here. Explain why it writes the scenarios_csv FROM CODE rather than downloading it (keeps it up to date as code changes quickly). However, this gets convoluted when you also have to initialize the attributes before you write?!?</p>
<div id="582dd132" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If you want to run SEALS with the run.py file in a different directory (ie in the project dir)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># then you need to add the path to the seals directory to the system path.</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    custom_seals_path <span class="op">=</span> <span class="va">None</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> custom_seals_path <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>: <span class="co"># G:/My Drive/Files/Research/seals/seals_dev/seals</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        sys.path.insert(<span class="dv">0</span>, custom_seals_path)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># SEALS will run based on the scenarios defined in a scenario_definitions.csv</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If you have not run SEALS before, SEALS will generate it in your project's input_dir.</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># A useful way to get started is to to run SEALS on the test data without modification</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># and then edit the scenario_definitions.csv to your project needs.</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Some of the other test files use different scenario definition csvs </span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># to illustrate the technique. If you point to one of these </span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (or any one CSV that already exists), SEALS will not generate a new one.</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The avalable example files in the default_inputs include:</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># - test_three_scenario_defininitions.csv</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># - test_scenario_defininitions_multi_coeffs.csvs</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    p.scenario_definitions_path <span class="op">=</span> os.path.join(p.input_dir, <span class="st">'scenario_defininitions.csv'</span>)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set defaults and generate the scenario_definitions.csv if it doesn't exist.</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> hb.path_exists(p.scenario_definitions_path):</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># There are several possibilities for what you might want to set as the default.</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Choose accordingly by uncommenting your desired one. The set of</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># supported options are</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># - set_attributes_to_dynamic_default (primary one)</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># - set_attributes_to_dynamic_many_year_default</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># - set_attributes_to_default # Deprecated</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>        gtap_invest_utils.set_attributes_to_dynamic_gtap_default(p) <span class="co"># Default option</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># # Optional overrides for us in intitla scenarios</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># p.aoi = 'RWA'</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># gtap_invest_utils.set_attributes_to_dynamic_default(p)</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Once the attributes are set, generate the scenarios csv and put it in the input_dir.</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>        gtap_invest_utils.generate_gtap_invest_scenarios_csv_and_put_in_input_dir(p)</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>        p.scenarios_df <span class="op">=</span> pd.read_csv(p.scenario_definitions_path)</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Read in the scenarios csv and assign the first row to the attributes of this object (in order to setup additional </span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># project attributes like the resolutions of the fine scale and coarse scale data)</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>        p.scenarios_df <span class="op">=</span> pd.read_csv(p.scenario_definitions_path)</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Because we've only read the scenarios file, set the attributes</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># to what is in the first row.</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> index, row <span class="kw">in</span> p.scenarios_df.iterrows():</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>            seals_utils.assign_df_row_to_object_attributes(p, row)</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span> <span class="co"># Just get first for initialization.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="task-format" class="level2">
<h2 class="anchored" data-anchor-id="task-format">Task Format</h2>
<p>Project flow requires a consistent format for tasks. The following is an example of a task that creates a correspondence file from gtap11 regions to gtapaez11 regions. The task itself defined as a function that takes a <code>p</code> object as an argument. This <code>p</code> object is a <code>ProjectFlow</code> object that contains all the project-level variables, manages folders and files, and manages tasks and parallelization. <code>p</code> also includes documentation, which will be written directly into the task directory.</p>
<p>Also note that any project-level attribute defined in between the function start and the <code>if p.run_this:</code> component are the “project level variables” that are fair-game for use in other tasks. These paths are critical for high performance because they enable quick-skipping of completed tasks and determiniation of which parts of the task tree need rerunning.</p>
<p>Tasks should be named as a noun (this breaks Python pep8 style) referencing what will be stored in the tasks output dir. This might feel awkward at first, but it means that the resultant file structure is easier to interpret by a non-EE outsider.</p>
<div id="05414486" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gtap_aez_seals_correspondences(p):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    p.current_task_documentation <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="st">    Create correspondence CSVs from ISO3 countries to GTAPv11 160</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="st">    regions, and then to gtapaezv11 50ish regions, also put the classification</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="st">    for seals simplification and luh.  </span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    p.gtap11_region_correspondence_input_path <span class="op">=</span> os.path.join(p.base_data_dir, <span class="st">'gtappy'</span>, <span class="st">'aggregation_mappings'</span>, <span class="st">'GTAP-ctry2reg.xlsx'</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    p.gtap11_region_names_path <span class="op">=</span> os.path.join(p.base_data_dir, <span class="st">'gtappy'</span>, <span class="st">'aggregation_mappings'</span>, <span class="st">'gtap11_region_names.csv'</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    p.gtap11_gtapaez11_region_correspondence_path <span class="op">=</span> os.path.join(p.base_data_dir, <span class="st">'gtappy'</span>, <span class="st">'aggregation_mappings'</span>, <span class="st">'gtap11_gtapaez11_region_correspondance.csv'</span>)    </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> p.run_this:</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">"logic here"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="automatic-directory-organization-via-tasks" class="level2">
<h2 class="anchored" data-anchor-id="automatic-directory-organization-via-tasks">Automatic Directory Organization via Tasks</h2>
<p>Hazelbean automatically defines directory organization as a function of the task tree. When the ProjectFlow object is created, it takes a directory as its only required input. This directory defines the root of the project. The other directory that needs to be referenced is the base_data_dir. When you initialize the p object, it notes this:</p>
<p><code>Created ProjectFlow object at C:\Users\jajohns\Files\gtap_invest\projects\cwon     from script C:\Users\jajohns\Files\gtap_invest\gtap_invest_dev\gtap_invest\run_cwon.py     with base_data set at C:\Users\jajohns\Files/base_data</code></p>
<p>In the run file, the following line generates the task tree:</p>
<p><code>gtap_invest_initialize_project.build_extract_and_run_aez_seals_task_tree(p)</code></p>
<p>Which points to a builder function in the initialize file, looking something like this:</p>
<p><img src="images/paste-28.png" class="img-fluid"></p>
<p>This would generate the following task tree:</p>
<p><img src="images/paste-27.png" class="img-fluid"></p>
<p>Two notations are especially useful within this task tree.</p>
<ol type="1">
<li>Within the function that defines a task, p.cur_dir points to the directory of that task. So for instance, the last task defined in the image above, in its code, you could reference p.cur_dir, and it would point to <code>&lt;project_root&gt;/econ_visualization/econ_lcovercom</code></li>
<li>Outside of a given function’s code, you can still refer to paths that were defined from within the functions code, but now (because you are outside the function) it is given a new reference. Using the example above, you could reference the same directory with <code>p.econ_lcovercom_dir</code> where the p attribute is named exactly as &lt;function_name&gt;_dir</li>
</ol>
<p>All of this setup enable another useful feature: automatic management of file generation, storage and downloading. This is done via the hazelbean function:</p>
<div id="90678135" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>useful_path <span class="op">=</span> hb.get_path(relative_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This function will iteratively search multiple locations and return the most “useful” one. By default, the relative_path variable will first joined with the p.cur_dir. If the file exists, it returns it. If not, it checks the next location, which is p.input_dir, and then p.base_data_dir. If it doesn’t find it anywhere, it will attempt to download it from google cloud (NYI) and save it in the p.cur_dir. If it is not available to download on google cloud, then it treats the path as something we will be generating within the task, and thus, get_path returns the first option above, namely joining the relative_path with p.cur_dir.</p>
<p>One important use-case that needs explaining is for tasks that generate files that will eventually be placed in the base_data_dir. The goal is to enable easy generation of it to the intermediate directory in the appropriate task_dir, but then have the ability to copy the files with the exact same relative path to the base_data_dir and have it still be found by p.get_path(). To do this, you will want to choose a path name relative to the tasks’ cur_dir that matches the desired directory relative to the base data dir. So, for example, we include <code>'gtappy', 'aggregation_mappings'</code> at the beginning of the relative path for in the intermediate directory in the appropriate task_dir, but then we also will want to copy the files with the exact same relative path to the base_data_dir and have it still be found by p.get_path(). To do this, you will want to choose a path name relative to the tasks’ cur_dir that matches that in the base_data_dir, for example <code>&lt;base_data_dir&gt;/'gtappy/aggregation_mappings/gadm_adm0.gpkg',</code></p>
<div id="3f9141ba" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>template_path <span class="op">=</span> p.get_path(os.path.join(<span class="st">'gtappy'</span>, <span class="st">'aggregation_mappings'</span>, <span class="st">'gadm_adm0.gpkg'</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It can be hard deciding what counts as a base_data_generating task or not, but generally if it is a file that will not be used by other projects, you should not treat it as a base_data_generating task. Instead, you should just make it relative to the cur_dir (or wahtever makes sense), as below:</p>
<div id="3cc65f52" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> p.get_path(os.path.join(aggregation_label <span class="op">+</span> <span class="st">'_'</span> <span class="op">+</span> experiment_label <span class="op">+</span> <span class="st">'_'</span> <span class="op">+</span> header <span class="op">+</span> <span class="st">'_stacked_time_series.csv'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>One additional exception to the above is if you are calling get_path outside of a task/task_tree. One common example is in the run file before you build the task tree. In this case, the default_dirs will not make sense, and so you need to specify it manually as here:</p>
<div id="43ad0930" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>p.countries_iso3_path <span class="op">=</span> p.get_path(os.path.join(<span class="st">'cartographic'</span>, <span class="st">'gadm'</span>, <span class="st">'gadm_adm0_10sec.gpkg'</span>), possible_dirs<span class="op">=</span>[p.input_dir, p.base_data_dir])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="validation-of-files" class="level2">
<h2 class="anchored" data-anchor-id="validation-of-files">Validation of files</h2>
<p>ProjectFlow is designed to calculate very fast while simultaneously validating that everything is approximately correct. It does this by checking for the existence of files (often combined with hb.get_path()). For example</p>
<div id="c840bff2" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>p.gadm_r263_gtapv7_r251_r160_r50_correspondence_vector_path <span class="op">=</span> p.get_path(os.path.join(<span class="st">'gtap_invest'</span>, <span class="st">'region_boundaries'</span>, <span class="st">'gadm_r263_gtapv7_r251_r160_r50_regions.gpkg'</span>))     </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> hb.path_exists(p.gadm_r263_gtapv7_r251_r160_r50_correspondence_vector_path):         </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    hb.log(<span class="st">'Creating '</span> <span class="op">+</span> p.gadm_r263_gtapv7_r251_r160_r50_correspondence_vector_path)         </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"computationally expensive thing here."</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>ProjectFlow very carefully defines whether or not you should run something based on the existence of specific paths. Usually this is just checking for each written path and only executing the code if it’s missing, but in some cases where lots of files are created, it’s possible to take the shortcut of just checking for the existence of the last-created path.</p>
<section id="eliminating-redundant-calculation-across-projects" class="level3">
<h3 class="anchored" data-anchor-id="eliminating-redundant-calculation-across-projects">Eliminating redundant calculation across projects</h3>
<p>If you have a time consuming task that, or example, writes to</p>
<div id="d40cb0d2" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>big_file_path <span class="op">=</span> hb.get_path(<span class="st">'lulc'</span>, <span class="st">'esa'</span>, <span class="st">'seals7'</span>, <span class="st">'convolutions'</span>, <span class="st">'2017'</span>, <span class="st">'convolution_esa_seals7_2017_cropland_gaussian_5.tif'</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this example, suppose you needed to create this file via your create_convolutions() task or something. When you first do this, it obviously won’t exist yet, so get_path() will join that relative path in the p.cur_dir location. If you run the ProjectFlow again, it will see it’s there and then instantly skip recalcualting it.</p>
<p>In addition to the 5 repos plus the EE repo, there is a managed base data set stored in teh same location</p>
<p><img src="images/paste-25.png" class="img-fluid"></p>
<p>A ProjectFlow object must have a base_data_dir set (I think…). This is because the p.get_path() will look in this folder for it, and/or will download to it.</p>
<p><img src="images/paste-26.png" class="img-fluid"></p>
</section>
<section id="python-tips-and-conventions" class="level3">
<h3 class="anchored" data-anchor-id="python-tips-and-conventions">Python Tips and Conventions</h3>
<p>For large files that take a long time to load, use a string-&gt;dataframe/dataset substitution as below. Make a LOCAL variable to contain the loaded object, and have that be assigned to the correct project-level path string. In subsequent usages, check type and if it’s still a string, then it hasn’t been loaded yet, so do that. I’m debating making it a project level variable trick</p>
<div id="c088657c" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>gadm <span class="op">=</span> p.gadm_adm0_vector_input_path    </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Just load it on first pass</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">type</span>(gadm) <span class="kw">is</span> <span class="bu">str</span>:</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    gadm <span class="op">=</span> hb.read_vector(p.gadm_adm0_vector_input_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="python-installation" class="level1">
<h1>Python Installation</h1>
<ul>
<li>Install Mambaforge from <a href="https://github.com/conda-forge/miniforge#mambaforge" class="uri">https://github.com/conda-forge/miniforge#mambaforge</a></li>
<li>For convenience, during installation, I select yes for “Add Mambaforge to my PATH environment Variable”</li>
<li>(PC) Open the Miniforge Prompt (search for it in the start menu) or (Mac) just type “mamba init”</li>
<li>Create a new mamba environment with the following commands (here it is named env2023a):</li>
</ul>
<p><code>mamba create -n env2023a -c conda-forge</code></p>
<ul>
<li>Activate the environment</li>
</ul>
<p><code>mamba activate research2023a</code></p>
<ul>
<li>Install libraries using the mamba command:</li>
</ul>
<p><code>mamba install -c conda-forge natcap.invest geopandas rasterstats netCDF4 cartopy xlrd markdown qtpy qtawesome plotly descartes pygeoprocessing taskgraph cython rioxarray dask google-cloud-datastore google-cloud-storage aenum anytree statsmodels openpyxl seaborn twine pyqt ipykernel imageio pandoc conda numba intake more-itertools google-api-python-client google-auth google-auth-oauthlib google-auth-httplib2 gdown tqdm</code></p>
</section>
<section id="hazelbean" class="level1">
<h1>Hazelbean</h1>
<section id="quickstart" class="level2">
<h2 class="anchored" data-anchor-id="quickstart">Quickstart</h2>
<p>Test that hazelbean imports correctly. Importing it will trigger compilation of the C files if they are not there.</p>
<div id="0b20a340" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> hazelbean <span class="im">as</span> hb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="library-of-useful-functions" class="level2">
<h2 class="anchored" data-anchor-id="library-of-useful-functions">Library of useful functions</h2>
<p>Explore examples of the useful spatial, statistical and economic functions in the examples section of this documentation.</p>
</section>
<section id="project-flow" class="level2">
<h2 class="anchored" data-anchor-id="project-flow">Project Flow</h2>
<p>One key component of Hazelbean is that it manages directories, base_data, etc. using a concept called ProjectFlow. ProjectFlow defines a tree of tasks that can easily be run in parallel where needed and keeping track of task-dependencies. ProjectFlow borrows heavily in concept (though not in code) from the task_graph library produced by Rich Sharp but adds a predefined file structure suited to research and exploration tasks.</p>
<section id="project-flow-notes" class="level3">
<h3 class="anchored" data-anchor-id="project-flow-notes">Project Flow notes</h3>
<p>Project Flow is intended to flow easily into the situation where you have coded a script that grows and grows until you think “oops, I should really make this modular.” Thus, it has several modalities useful to researchers ranging from simple drop-in solution to complex scripting framework.</p>
<section id="notes" class="level4">
<h4 class="anchored" data-anchor-id="notes">Notes</h4>
<p>In run.py, initialize the project flow object. This is the only place where user supplied (possibly absolute but can be relative) path is stated. The p ProjectFlow object is the one global variable used throughout all parts of hazelbean.</p>
<div id="7fb39d5b" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> hazelbean <span class="im">as</span> hb</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> hb.ProjectFlow(<span class="vs">r'C:\Files\Research\cge\gtap_invest\projects\feedback_policies_and_tipping_points'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In a multi-file setup, in the run.py you will need to import different scripts, such as main.py i.e.:</p>
<div id="1c765a4f" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> visualizations.main</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The script file mainpy can have whatever code, but in particular can include “task” functions. A task function, shown below, takes only p as an agrument and returns p (potentially modified). It also must have a conditional (if p.run_this:) to specify what always runs (and is assumed to run trivially fast, i.e., to specify file paths) just by nature of having it in the task tree and what is run only conditionally (based on the task.run attribute, or optionally based on satisfying a completed function.)</p>
<div id="84fc2163" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> example_task_function(p):</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Fast function that creates several tiny geotiffs of gaussian-like kernels for later use in ffn_convolve."""</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> p.run_this:</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> computationally_intensive_loop:</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(i)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Important Non-Obvious Note</strong></p>
<p>Importing the script will define function(s) to add “tasks”, which take the ProjectFlow object as an argument and returns it after potential modification.</p>
<div id="69081afc" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_all_tasks_to_task_tree(p):</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    p.generated_kernels_task <span class="op">=</span> p.add_task(example_task_function)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
</section>
<section id="gtappy" class="level1">
<h1>GTAPPy</h1>
<section id="installation" class="level2">
<h2 class="anchored" data-anchor-id="installation">Installation</h2>
<section id="cython-installation" class="level3">
<h3 class="anchored" data-anchor-id="cython-installation">Cython Installation</h3>
<p><img src="images/paste-3.png" class="img-fluid"></p>
<p><img src="images/paste-4.png" class="img-fluid"></p>
<p><img src="images/paste-5.png" class="img-fluid"></p>
<p><img src="images/paste-6.png" class="img-fluid"></p>
<p><img src="images/paste-8.png" class="img-fluid"></p>
<p><img src="images/paste-9.png" class="img-fluid"></p>
<p><img src="images/paste-10.png" class="img-fluid"></p>
</section>
<section id="run-gtap-installation-simple-for-class" class="level3">
<h3 class="anchored" data-anchor-id="run-gtap-installation-simple-for-class">Run-GTAP installation simple for class</h3>
<p><strong>Step 1:</strong></p>
<ul>
<li><p>Install RunGTAP at <a href="https://www.gtap.agecon.purdue.edu/products/rungtap/default.asp" class="uri">https://www.gtap.agecon.purdue.edu/products/rungtap/default.asp</a></p></li>
<li><p>At <a href="https://www.copsmodels.com/gpeidl.htm" class="uri">https://www.copsmodels.com/gpeidl.htm</a> download: <a href="https://www.copsmodels.com/ftp/ei12dl/gpei-12.1.004-install.exe" class="uri">https://www.copsmodels.com/ftp/ei12dl/gpei-12.1.004-install.exe</a>&nbsp;</p>
<ul>
<li>OR FOR VERSION 12: <a href="https://www.copsmodels.com/ftp/ei12dl/gpei-12.0.004-install.exe" class="uri">https://www.copsmodels.com/ftp/ei12dl/gpei-12.0.004-install.exe</a></li>
</ul></li>
<li><p>Install to default location</p></li>
</ul>
<p><img src="images/paste-13.png" class="img-fluid"></p>
<p>Proceed without selecting a license (to start the 6 month trial).</p>
<p><strong>Step 2:</strong> Install GTAPAgg2: <a href="https://www.gtap.agecon.purdue.edu/private/secured.asp?Sec_ID=1055" class="uri">https://www.gtap.agecon.purdue.edu/private/secured.asp?Sec_ID=1055</a></p>
<p>TO PROCEED, YOU NEED TO HAVE A ACCESS TO THE GTAP DATABASE. OR YOU CAN ACCESS IT THROUGH <code>ee_internal</code> DATABASE.</p>
<hr>
<p><strong>Step 2.1:</strong> - Extract the <code>.lic</code> file from <a href="https://www.gtap.agecon.purdue.edu/databases/download.asp" class="uri">https://www.gtap.agecon.purdue.edu/databases/download.asp</a> step 2. Put this in <code>GTAPAgg2</code> dir</p>
<p><strong>Step 2.2:</strong> - Install the GTAP Database itself from at : <a href="https://www.gtap.agecon.purdue.edu/databases/download.asp" class="uri">https://www.gtap.agecon.purdue.edu/databases/download.asp</a></p>
<ul>
<li>Make sure to also get the AEZ version, which will also give a full pkg file.</li>
</ul>
<p><img src="images/paste-11.png" class="img-fluid"></p>
<ul>
<li><p>Put this <code>.pkg</code> file in <code>GTPAg2</code> dir.&nbsp;</p></li>
<li><p>Launch GTPAg2, identify pkg file for both default and AEZ data</p></li>
</ul>
<p>When running aggregations, make sure to choose the right product:</p>
<p><img src="images/paste-12.png" class="img-fluid"></p>
<p><strong>Step 2.3:</strong> Running the unaggregated version - Open GTPAg2.exe</p>
<p><img src="images/paste-14.png" class="img-fluid"></p>
<ul>
<li><p>Use this to aggregate a 1-1 version.</p>
<ul>
<li><p>Create a 1-1 mapping</p>
<ul>
<li><p>View change regional aggregation, sector aggregation, setting to 1:1</p></li>
<li><p>For factor aggregation, it defaults to 8-5, can set this to 8:8.</p></li>
</ul></li>
<li><p>Read aggregation scheme from file, loa default.agg is 10 by 10</p></li>
<li><p>For factors, if using AEZ, there is land specified by each AEZ. Erwin is working to fix this. Because didn’t have it ready, went back to standard GTAP package of data.</p></li>
<li><p>Used full 8 factors, make new things “mobile factors”.</p></li>
</ul></li>
</ul>
<!-- -->
<ul>
<li>Save aggregation scheme to file to AggStore</li>
</ul>
<p><img src="images/paste-15.png" class="img-fluid"></p>
<p>Save aggregation scheme to file to AggStore</p>
<p><img src="images/paste-17.png" class="img-fluid"></p>
<p>This could also be done by making the .agg file via text editing.&nbsp;</p>
<ul>
<li>Then finally Create aggregated database in GTAPAgg</li>
</ul>
<p><img src="images/paste-18.png" class="img-fluid"></p>
<p>Note that this creates two versions of the database, one for GTAP code v6.2, one for v7.0. The 7.0 is in a sub zip folder gtapv7.zip. This is the one we want.</p>
</section>
</section>
<section id="cgtpag2aggstoregtap10a_gtap_2014_65x141gtapv7" class="level2">
<h2 class="anchored" data-anchor-id="cgtpag2aggstoregtap10a_gtap_2014_65x141gtapv7"><code>C:\\GTPAg2\\AggStore\\GTAP10A_GTAP_2014_65x141\\gtapv7</code></h2>
<p><strong>Getting the v7 code</strong></p>
<ul>
<li><p>Extract from RunGTAP (lol)</p></li>
<li><p>Under Version, Change, set to <code>NCORS3x3</code></p></li>
<li><p>Under Version, New, use wizard using same aggregation and simply copying.</p></li>
</ul>
<p><img src="images/paste-19.png" class="img-fluid"></p>
<ul>
<li><p>This will create a new folder in c:/runGTAP375 named v7all.</p></li>
<li><p>Now we will replace the data files in v7all with the fully disaggregated database (in the v7 dir) we created above.</p></li>
<li><p>Notice also in the v7dir we have shock files, e.g.&nbsp;<code>tinc.shk</code>.&nbsp;</p>
<ul>
<li><p>By default, these will be inherited from the old 3x3 version.</p></li>
<li><p>Under Tools, Run Test Simulation. This will rewrite new shk files to match aggregation.</p>
<ul>
<li>ALSO NOTE, this is the full run that tested it all worked.</li>
</ul></li>
<li><p>To check that it worked, go to results, macros.&nbsp;</p></li>
<li><p>Or, could open results in <code>ViewSOL</code>. Use View -&gt; Results Using ViewSOL</p>
<ul>
<li><p><code>ViewSOL</code> has the full results, whereas RunGTAP only has a subset by the limited mapping specific to <code>RunGTAP</code>. <code>ViewSOL</code> loads the whole <code>sl4</code> file.</p></li>
<li><p>Here you could go to e.g.&nbsp;<code>pgdp</code> to see that prices all went up by 10%, which is the default shock i guess?</p></li>
</ul></li>
<li><p>OR, from <code>ViewSOL</code> File, can open in <code>ViewHAR</code>, which gives even more power, such as dimensional sorting.</p></li>
</ul></li>
<li><p>Now we can run a non-trivial shock. So for global ag productivity shock, let’s increase productivity.</p>
<ul>
<li><p>In <code>RunGTAP</code>, go to view <code>RunCMFSTART</code> file. Here we will define a new set for the new experiments. (<code>CMFSTART</code> files sets settings for runtime, but also which are the files that should be called, along with sets for the closure).</p>
<ul>
<li><p>To do this, go to <code>RunGTAP-\&gt;View-\&gt;Sets</code>, enable advanced editing, <code>Sets-\&gt;View Set Library</code></p>
<ul>
<li><p>Here click on <code>COMM</code>, copy elements in <code>tablo</code> format. This will get the set definition in <code>tablo</code> format of ALL the commodities. From this you can pare down to which you want to shock,</p></li>
<li><p>For the moment, we will create two sets, one for ag commodities (<code>ag_comm</code>), and one for a smaller subset of agg commodities (<code>ag_comm_sm</code>).</p></li>
<li><p>And will also define what is the complementary set (<code>xag_comm_sm</code>) of <code>ag_comm_sm</code>.</p></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<p><img src="images/paste-20.png" class="img-fluid"></p>
<p>Now that the sets are defined, can use them in defining the SHOCKS</p>
<p><img src="images/paste-21.png" class="img-fluid"></p>
<ul>
<li><p>Set the solution method to <code>gragg 2-4-6</code></p></li>
<li><p>Save experiment.</p></li>
<li><p>Then Solve!</p>
<ul>
<li>Comment from TOM: If Gragg doesn’t work, use Euler with many steps 20-50</li>
</ul></li>
</ul>
<p><strong>From second call with Erwin on cmd and rungtap versions</strong></p>
<ul>
<li><p>Note that now we have a tax, we do it on both domestic and imported, then write a new equation that makes them sum up:&nbsp;</p>
<ul>
<li>E_tpm (all, c, COMM)(all, r, REG) tmp(c, r) = tpmall + tpreg + tpall</li>
</ul></li>
<li><p>Note that we now set the rate% of beef tax to increase 50%. Before we were increasing it by a 50% POWER OF THE tariff.</p></li>
<li><p>First run testsim.bat.</p></li>
<li><p>Then run the simulations.</p></li>
<li><p>In rungtapv7.bat then,&nbsp;</p></li>
<li><p>Simresults.bat last. Takes the sl4 files and converts it into a har file (.sol), and then combines them into 1 file, then splits to CSV.</p></li>
<li><p>RMAC is full dimension, RMCA is aggregated by chosen aggregation simplification.</p>
<ul>
<li>AggMap.har defines the aggregation.</li>
</ul></li>
<li><p>Them Allres.CMF is run, which actually does the aggregation.</p>
<ul>
<li>Allres.cmf calls to allres.tab, which cleans the results. This would need to have new scenarios added to the top</li>
</ul></li>
<li><p>Allres.EXP also needs to be updated, along with the scenario EXP files to h</p></li>
<li><p>ave thecorrect exogenous variables, such as tpdall</p></li>
</ul>
<p><strong>alternatively just specify they use hb.get_path() to the private database.</strong></p>
</section>
<section id="iterating-over-multiple-aggregations" class="level2">
<h2 class="anchored" data-anchor-id="iterating-over-multiple-aggregations">Iterating over multiple aggregations</h2>
<p>GTAPPY runs for multiple aggregations and follows the philosophy that for a well-built model, the results will be intuitively similar for different aggregations and thus it serves as a decent check. This is similar to “leave-one-out” testing in regression.</p>
</section>
<section id="release-notes" class="level2">
<h2 class="anchored" data-anchor-id="release-notes">Release notes</h2>
<section id="v2023-12-18" class="level3">
<h3 class="anchored" data-anchor-id="v2023-12-18">v2023-12-18</h3>
<p>We need to clarify how we go from a erwin-style mapping xlsx to EE spec. Below is what it looks like as downloaded from erwin.</p>
<p>GTAP-ctry2reg [source from erwin converted to EE spec].xlsx</p>
<p><img src="images/paste-1.png" class="img-fluid"></p>
<p>Manually renamed to gtapv7_r251_r160_correspondence.xlsx (must be excel cause multi workbook). Also need to put the legend information somewhere else in a well-thought-out place (not attached to regions correspondnce)</p>
<p>Note that eg No.&nbsp;is used twice where the first is r160 and the second is r251. New input mapping should clarify</p>
<p>Similar for sectors</p>
<p><img src="images/paste-2.png" class="img-fluid"></p>
<p>First note, the word “sector” is specific to the case when you aren’t specifying if you’re talking about COMM (commodities) or ACTS (activities) because I’m not quite sure of the differentiation at this point.</p>
<p>Notes from Erwin on GTAPPY</p>
</section>
<section id="v2023-12-15" class="level3">
<h3 class="anchored" data-anchor-id="v2023-12-15">v2023-12-15</h3>
<p>Issues resolved:</p>
<ol type="1">
<li><p>In the release’s Data folder, the aggregation label gtapaez11-50 should be renamed v11-s26-r50, correct?</p></li>
<li><p>Also note that I have decided to have the most recent release always have NO timestamp whereas dated versions of same-named models/aggregations should add on the timestamp of when they were first released</p></li>
<li><p>Propose changing the names of the cmf files from cwon_bau.cmf to gtapv7-aez-rd_bau.cmf and cwon_bau-es.cmf to gtapv7-aez-rd_bau-es (note difference between hyphens (which imply same-variable) and underscores, which are used to split into list.)</p></li>
<li><p>Propose not using set PROJ=cwon in the CMF as that is defined by the projectflow object.</p></li>
<li><p>propose changing SIMRUN to just ‘experiment_name’ ie “bau” rather than “projname” + “bau”</p></li>
<li><p>Reorganize this so that data is in the base_data_dir and the output is separated from the code release” set MODd=..set CMFd=.</p></li>
</ol>
<p>set SOLd=..set DATd=..%AGG%</p>
<p>THESE TWO STAY OUTSIDE THE RELEASE</p>
<ol start="7" type="1">
<li><p>This basic idea now is that there is a release that someone downloads, and they could run it either by calling the bat file or by calling the python run script. This means i’m trying to make the two different file types as similar as possible. However, note that the bat file is only going to be able to replicate a rd run without ES, so technically the python script can contain a bat file but not vice versa.</p></li>
<li><p>Renamce command line cmf options as tehy’re referenced in the cmf file: # CMF: experiment_label # Rename BUT I understand this one might not be changeable because it appears to be defined by the filename of the CMF? # p1: gtap_base_data_dir # p2: starting_data_file_path # Rename points to the correct starting har # p3: output_dir # Rename # p4: starting_year # Rename # p5: ending_year # Rename</p></li>
<li><p>Simple question: Is there any way to read the raw GEMPACK output to get a sense of how close to complete you are? I would like to make an approximate progress bar.</p></li>
</ol>
<ul>
<li><p>When you say “automatic accuracy”, you can.</p>
<p>+++&gt; Beginning subinterval number 4.</p>
<p>—&gt; Beginning pass number 1 of 2-pass calculation, subinterval 4.</p>
<p>Beginning pass number 6 of 6-pass calculation, subinterval 6</p></li>
</ul>
<ol start="10" type="1">
<li>Would it be possible to not put a Y in front of years like Y2018? This can mess up string-&gt;int conversions.</li>
</ol>
<p>keep Y, gempack can’t have non-numeric characters at the start of a var</p>
<ol start="11" type="1">
<li>There is no bau-SUM_Y2050 (but ther is for VOL and WEL). Is this intentional?</li>
</ol>
<p>NO! SUM describes the starting database.</p>
<p>Welfare not possibly in RD because no discount rate eg</p>
<ol start="12" type="1">
<li>Question: Is EVERYTHING stored in the SL4? I.e., are the other files redundant?</li>
</ol>
<p>No, apparently things like the converting the sl4 to volume terms is not stored in the sl4, so that needs to come in on sltht or in ViewSOL</p>
</section>
<section id="v2023-11-01" class="level3">
<h3 class="anchored" data-anchor-id="v2023-11-01">v2023-11-01</h3>
<section id="shocks-implemented" class="level4">
<h4 class="anchored" data-anchor-id="shocks-implemented">Shocks implemented</h4>
<ol type="1">
<li>Different population file replacements</li>
<li>GDP change</li>
<li>Yield changes?</li>
</ol>
</section>
<section id="example-run-file" class="level4">
<h4 class="anchored" data-anchor-id="example-run-file">Example run file</h4>
<p><img src="images/2022-12-12-10-31-05.png" class="img-fluid"></p>
<p>At the top we create the project flow object. We will add tasks to this.</p>
</section>
<section id="example-executable-call" class="level4">
<h4 class="anchored" data-anchor-id="example-executable-call">Example executable call</h4>
<p><img src="images/2022-12-12-10-33-44.png" class="img-fluid"></p>
</section>
<section id="harder-part-to-do-is-figuring-out-how-to-have-the-shocks-work" class="level4">
<h4 class="anchored" data-anchor-id="harder-part-to-do-is-figuring-out-how-to-have-the-shocks-work">Harder part to do is figuring out how to have the shocks work</h4>
<p>Need to create xSets, xSubsets, Shock. Could use READFROMFILE command in tablo cmf.</p>
</section>
<section id="what-are-the-different-kinds-of-shocks" class="level4">
<h4 class="anchored" data-anchor-id="what-are-the-different-kinds-of-shocks">What are the different kinds of shocks</h4>
<p><strong>Uniform</strong> Shockaoall(AGCOM_SM, reg) = uniform 20;</p>
<p>Another more</p>
<p>aoall(ACTS, REG) = file select from file pointing to a list of all regions. 0 is no shock.</p>
<p>Everything in the exogenous list can be shocks.</p>
<p>Also can SWAP an initially endogenous with exogenous.</p>
<p>E.g. swap aoreg with GDP</p>
<p>What about changing an elasticity?</p>
<p>those are in gtapparm, so write a new .prm (this is not a shock but is just replacing an input.)</p>
<p>Notice that there are shocks vs data updates.</p>
<p>The elasticities are being calibrated??? if you change the basedata to basedata2, then a different default2.prm, with no shock, the model will replicate the initial database.</p>
<p>If it’s a supply response elasticity (as in PNAS) that WILL affect it (unlike above).</p>
<p>needs to be percentage change over default POP. In base data. Read this in and process it against Eric’s file.</p>
<p>Shock pop(REG) = SELECT FROM FILE filename header 4ltr header. Swap QGDP aoreg shock aoall (agcom_sm, reg) = select from yield file.</p>
</section>
</section>
</section>
</section>
<section id="seals" class="level1">
<h1>SEALS</h1>
<section id="from-readme-might-be-redundant" class="level2">
<h2 class="anchored" data-anchor-id="from-readme-might-be-redundant">From Readme (might be redundant)</h2>
<p>SEALS is under active development and will change much as it moves from a personal research library to supported model. We have submitted this code for publication but are waiting on reviews. For installation and other details, see the <a href="https://justinandrewjohnson.com/seals/documentation">SEALS documentation</a>.</p>
<p>To run a minimal version of the model, open a terminal/console and navigate to the directory where run_test_seals.py is located. Then, simply run: &gt; python run_test_seals.py</p>
<p>In order for the above line to work, you will need to set the project directory and data directory lines in run_test_seals.py. To obtain the base_data necessary, see the SEALS manuscript for the download link.</p>
<p>To run a full version of the model, copy run_test_seals.py to a new file (i.e., run_seals.py) and set p.test_mode = False. You may also want to specify a new project directory to keep different runs separate.</p>
<p><img src="images/paste-35.png" class="img-fluid"></p>
<p>images/2024-01-18-08-25-09.png</p>
<p><img src="images/paste-36.png" class="img-fluid"></p>
</section>
<section id="release-notes-1" class="level2">
<h2 class="anchored" data-anchor-id="release-notes-1">Release Notes</h2>
<section id="update-v0.5.0" class="level3">
<h3 class="anchored" data-anchor-id="update-v0.5.0">Update v0.5.0</h3>
<p>Downloading of base data now works.</p>
</section>
<section id="update-v0.4.0" class="level3">
<h3 class="anchored" data-anchor-id="update-v0.4.0">Update v0.4.0</h3>
<p>Now all project flow objects can be set via a scenario_definitions.csv file, allowing for iteration over multiple projects.</p>
<p>If no scenario_definitions.csv is present, it will create the file based on the parameters set in the run file.</p>
</section>
</section>
<section id="numpy-errors" class="level2">
<h2 class="anchored" data-anchor-id="numpy-errors">Numpy errors</h2>
<p>If numpy throws “wrong size or changes size binary”: upgrade numpy at the end of the installation process. See for details: <a href="https://stackoverflow.com/questions/66060487/valueerror-numpy-ndarray-size-changed-may-indicate-binary-incompatibility-exp" class="uri">https://stackoverflow.com/questions/66060487/valueerror-numpy-ndarray-size-changed-may-indicate-binary-incompatibility-exp</a></p>
</section>
<section id="mac-specific-errors" class="level2">
<h2 class="anchored" data-anchor-id="mac-specific-errors">Mac specific errors</h2>
<p>Your python environment has to have permissions to access and write to the base data folder.</p>
</section>
<section id="hazelbean-1" class="level2">
<h2 class="anchored" data-anchor-id="hazelbean-1">Hazelbean</h2>
<p>SEALS relies on the Hazelbean project, available via PIP. Hazelbean is a collection of geospatial processing tools based on gdal, numpy, scipy, cython, pygeoprocessing, taskgraph, natcap.invest, geopandas and many others to assist in common spatial analysis tasks in sustainability science, ecosystem service assessment, global integrated modelling assessment, natural capital accounting, and/or calculable general equilibrium modelling.</p>
<p>Note that for hazelbean to work, your computer will need to be configured to compile Cython files to C code. This workflow is tested in a Python 3.10, 64 bit Windows environment. It should work on other system environments, but this is not yet tested.</p>
</section>
<section id="project-flow-1" class="level2">
<h2 class="anchored" data-anchor-id="project-flow-1">Project Flow</h2>
<p>One key component of Hazelbean is that it manages directories, base_data, etc. using a concept called ProjectFlow. ProjectFlow defines a tree of tasks that can easily be run in parallel where needed and keeping track of task-dependencies. ProjectFlow borrows heavily in concept (though not in code) from the task_graph library produced by Rich Sharp but adds a predefined file structure suited to research and exploration tasks.</p>
</section>
<section id="first-run-walkthrough-tutorial" class="level2">
<h2 class="anchored" data-anchor-id="first-run-walkthrough-tutorial">First run walkthrough tutorial</h2>
<p>The simplest way to run SEALS is to clone the repository and then open run_test_seals.py in your preferred editor. Then, update the values in ENVIRONMENT SETTINGS near the top of run_test_seals.py for your local computer (ensuring this points to directories you have write-access for and is not a virtual/cloud directory).</p>
<div id="deb4ade6" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">### ------- ENVIRONMENT SETTINGS -------------------------------</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Users should only need to edit lines in this ENVIRONMENT SETTINGS section</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Everything is relative to these (or the source code dir).</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Specifically,</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1. ensure that the project_dir makes sense for your machine</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2. ensure that the base_data_dir makes sense for your machine</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3. ensure that the data_credentials_path points to a valid credentials file</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 4. ensure that the input_bucket_name points to a cloud bucket you have access to</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># A ProjectFlow object is created from the Hazelbean library to organize directories and enable parallel processing.</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># project-level variables are assigned as attributes to the p object (such as in p.base_data_dir = ... below)</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The only agrument for a project flow object is where the project directory is relative to the current_working_directory.</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    user_dir <span class="op">=</span> os.path.expanduser(<span class="st">'~'</span>)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    script_dir <span class="op">=</span> os.path.dirname(os.path.realpath(<span class="va">__file__</span>))</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    project_name <span class="op">=</span> <span class="st">'test_seals_project'</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    project_dir <span class="op">=</span> os.path.join(user_dir,  <span class="st">'seals'</span>, <span class="st">'projects'</span>, project_name)</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> hb.ProjectFlow(project_dir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The project name and the project dir will define the root directory where all files will be saved. This directory is given <code>hb.ProjectFlow()</code> to initalize the project (which will create the dirs). Once these are set, you should be able to run run_test_seals.py in your preferred way, ensuring that you are in the Conda environment discussed above. This could be achieved in VS Code by selecting the Conda environment in the bottom-right status bar and then selecting run. Alternatively, this could be done via the command line with the command <code>python run_test_seals.py</code> in the appropriate directory.</p>
<p>When SEALS is run in this way, it will use the default values for a test run on a small country (Rawanda). All of these values are set (and documented) in the run file (run_test_seals.py) in the SET DEFAULT VARIABLES section. For your first run, it is recommended to use the defaults. When run, a configuration file will be written into your project’s input_dir named scenario_definitions.csv. This file is a table where each row is a “scenario” necessary to be defined for SEALS to run. In this minimal run, it must have 2 rows: one for the baseline condition (the starting LULC map) and one for a scenario of change that will indicate how much change of each LU class will happen in some coarse grid-cell or region/zone. Inspecting and/or modifying this file may give insights on how to customize a new run.</p>
<div id="36e431ae" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">### ------- SET DEFAULT VARIABLES --------------------------------</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the path to the scenario definitions file. This is a CSV file that defines the scenarios to run.</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># If this file exists, it will load all of the attributes from this file and overwrite the attributes</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># set above. This is useful because adding new lines to to the scenario definitions file will allow</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># you to run many different scenarios easily. If this file does not exist, it will be created based</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># on the attributes set above and saved to the location in scenarios_definitions_path.</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>p.scenario_definitions_path <span class="op">=</span> os.path.join(p.input_dir, <span class="st">'scenario_defininitions.csv'</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co"># IMPORTANT </span><span class="al">NOTE</span><span class="co">: If you set a scenario_definitions_path, then the attributes set in this file (such as p.scenario_label below)</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co"># will be overwritten. Conversely, if you don't set a scenario_definitions_path, then the attributes set in this file will be used</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co"># and will be written to a CSV file in your project's input dir.</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co"># If you did not set a p.scenarios_definitions_path, the following default variables will be used</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co"># and will be written to a scenarios csv in your project's input_dir for later use/editing/expansion.</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="co"># String that uniquely identifies the scenario. Will be referenced by other scenarios for comparison.</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>p.scenario_label <span class="op">=</span> <span class="st">'ssp2_rcp45_luh2-globio_bau'</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Scenario type determines if it is historical (baseline) or future (anything else) as well</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co"># as what the scenario should be compared against. I.e., Policy minus BAU.</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>p.scenario_type <span class="op">=</span> <span class="st">'bau'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This computing stack also uses hazelbean to automatically download needed data at run time. In the code block below, notice the absolute path assigned to p.base_data_dir. Hazelbean will look here for certain files that are necessary and will download them from a cloud bucket if they are not present. This also lets you use the same base data across different projects.</p>
<p>In addition to defining a base_data_dir, you will need to For this to work, you need to also point SEALS to the correct data_credentials_path. If you don’t have a credentils file, email jajohns@umn.edu. The data are freely available but are very, very large (and thus expensive to host), so I limit access via credentials.</p>
<div id="bc449b93" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>p.base_data_dir <span class="op">=</span> os.path.join(<span class="st">'G:/My Drive/Files/base_data'</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>p.data_credentials_path <span class="op">=</span> <span class="st">'..</span><span class="ch">\\</span><span class="st">api_key_credentials.json'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>NOTE THAT the final directory has to be named base_data to match the naming convention on the google cloud bucket.</p>
</section>
<section id="running-the-model" class="level2">
<h2 class="anchored" data-anchor-id="running-the-model">Running the model</h2>
<p>After doing the above steps, you should be ready to run <code>run_test_seals.py</code>. Upon starting, SEALS will report the “task tree” of steps that it will compute in the ProjectFlow environment. To understand SEALS in more depth, inspect each of the functions that define these tasks for more documention in the code.</p>
<p>Once the model is complete, go to your project directory, and then the intermediate directory. There you will see one directory for each of the tasks in the task tree. To get the final produce, go to the stitched_lulc_simplified_scenarios directory. There you will see the base_year lulc and the newly projected lulc map for the future year:</p>
<p><img src="images/paste-3.png" class="img-fluid"> [THIS IS NOT THE CORRECT IMAGE]</p>
<p>Open up the projected one (e.g., lulc_ssp2_rcp45_luh2-message_bau_2045.tif) in QGIS and enjoy your new, high-resolution land-use change projection!</p>
</section>
<section id="more-seals-details" class="level2">
<h2 class="anchored" data-anchor-id="more-seals-details">More SEALS details</h2>
<section id="linking-paths" class="level3">
<h3 class="anchored" data-anchor-id="linking-paths">Linking paths</h3>
<p>The logic used for paths in SEALS is confusing at first, but it enables efficient processing of very large files (and minimizes re-downloading or re-processing data. When a path to a file is specified in SEALS, often SEALS will call a function in hazelbean that checks multiple places for that file to exist, as in the code below.</p>
<div id="f5f06253" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> hb.get_first_extant_path(path, [p.input_dir, p.base_data_dir])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If the path given is relative, this function will then iterate through the list of possible directories and join the path to each directory, continuing down the list until it finds an existing path. If it never finds it, the function will return the path joined with the first element in the list (presumably for later file creation). This functionality means that if a file is in your base data directory, hazelbean will not download it. As a protip, after the first time it’s downloaded, you can move it from the input_dir to your base_data_dir (while keeping the exact same relative directory path) and then Hazelbean will not waste time re-downloading.</p>
</section>
</section>
</section>
<section id="global-invest" class="level1">
<h1>Global InVEST</h1>
<p>NYI</p>
</section>
<section id="gtap-invest" class="level1">
<h1>GTAP-InVEST</h1>
<p>NYI.</p>
</section>
<section id="naming-conventions" class="level1">
<h1>Naming conventions</h1>
<section id="id-index-label-name-description" class="level3">
<h3 class="anchored" data-anchor-id="id-index-label-name-description">Id, index, label, name, description</h3>
<p>In programming, <code>id</code> and <code>index</code> are two different concepts that are used in different contexts.</p>
<p><code>id</code> refers to the unique identifier of an object. In this specification, it is an integer that is sorted by the ONE in the many-to-one correspondence, sorted alphabetically at generation time (though not necessarily to remain sorted given downstream correspondences).</p>
<p><code>index</code> refers to the position of an element in a sequence (e.g.&nbsp;a list or a string). In the context of a correspondence file, this is the position of the row within the sorted spreadsheet, but is not assumed to be stable and shouldn’t generally be used.</p>
<p><code>labelheader</code> refers to an (exactly) 4 character string that is lowercase-alphanumeric with no special symbols besides underscore. Useful for the Header label in har files. Technically is case insensitive but we assume lowercase.</p>
<p><code>labelshort</code> refers to an 8-character or less string that is lowercase-alphanumeric with no special symbols besides underscore. Useful for .har files.</p>
<p><code>label</code> refers to a string that is lowercase-alphanumeric with no special symbols besides underscore</p>
<p><code>name</code> refers to a string of any ascii characters with python-style escaping of special characters: <code>'She\'s a star!'</code> . It’s assumed to be short enough to view as a column header or plot label</p>
<p><code>Description</code>refers to a <code>name</code> of any length with detailed description, possibly even formatted MD text.</p>
<p>If there is a domain, described below, id, index, etc all should prepended with it to be eg gadm_id.</p>
</section>
<section id="id-index-etc.-in-the-context-of-vector-data" class="level3">
<h3 class="anchored" data-anchor-id="id-index-etc.-in-the-context-of-vector-data">Id, Index etc. in the context of vector data</h3>
<p>Note that geopandas assumes the vector data are indexed with an FID. This is the order in which the geometries are added to the file and can get wonky when dealing with legacy file types (like ESRI Shapefiles). Additionally, when you write a GPKG to a CSV, it will not include the fid, so you might lose data. To fix this, EE spec requires that any GPKG when saved as a CSV have a new column, <code>id</code> added as the first col, which is generated starting at 1 and incrementing up by 1 after having sorted the data on the simplest non-fid label (e.g., iso3_label). See gtap_invest_generate_base_data.py.</p>
</section>
<section id="labels-files" class="level3">
<h3 class="anchored" data-anchor-id="labels-files">Labels files</h3>
<p>Based on how the GTAP database is structured, EE spec defines several file types of files to systemetize how dimensions/sets are defined (and then used in e.g.&nbsp;figure plotting). A single dimension is first defined by a labels file. The labels file has at least 3 columns of domain_id, domain_label, domain_name and optionally a domain_description. If present, a column needs to be fully filled (no missing values). Label files are used in other contexts to, e.g., go from id to name for labeling an axis on a plot, as well as building the correspondence files below.</p>
</section>
<section id="correspondences" class="level3">
<h3 class="anchored" data-anchor-id="correspondences">Correspondences</h3>
<p>Model linkages often require mapping many-to-one relationship in a consistent way. Correspondence files define this via a src-to-dst (source and destination). They are named according to a relatively complex pattern. Specifically, using the file path <code>gadm_r263_gtapv7_r251_r160_r50_correspondence</code>, we have a domain label <code>gadm</code> followed by a src dimension-size pair <code>r263</code> (where r is a label, short for region in this case, and 263 is the number of unique entries in that dimension). To be a correspondence,there needs to be at least one other dst dimension-size pair, where in this case there are 3 additional dimension-size pairs (<code>r251</code>, <code>r160</code>, and <code>r50</code>). However, the later three pairs are from a different domain, namely that of <code>gtapv7</code>. Each pair is identified with the domain most identified most closely prior. The dst dimension-size pairs are sorted in order of decreasing size. The dst dimension-size pairs are then followed by the word <code>correspondence</code>. This example creates a correspondence file that maps from the GADM 263 regions to the GTAPv7 251 regions, which are then mapped to the GTAPv7 160 regions, which are then mapped to the GTAPv7 50 regions.</p>
<p>An example of a 2-type correspondence is below. However, in this file, src and dst would have to be replaced with the specific domain names used.</p>
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th>src_id</th>
<th>dst_id</th>
<th>src_label</th>
<th>dst_label</th>
<th>src_description</th>
<th>dst_description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>aus</td>
<td>oceania</td>
<td>Australia</td>
<td>Oceania (including NZ and AUS)</td>
</tr>
<tr class="even">
<td>2</td>
<td>1</td>
<td>nzl</td>
<td>oceania</td>
<td>New Zealand</td>
<td>Oceania (including NZ and AUS)</td>
</tr>
</tbody>
</table>
<p>Here are the specific labels and corespondence files generated for gtapv7-aez-rd:</p>
<p><img src="images/paste-22.png" class="img-fluid"></p>
<p>If defined exactly right, 2 dimensional correspondence files will work with <code>Hazelbean</code> via</p>
<p><code>seals_utils.set_derived_attributes(p)</code></p>
<p>and</p>
<div id="e03408a3" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>p.lulc_correspondence_dict <span class="op">=</span> hb.utils.get_reclassification_dict_from_df(p.lulc_correspondence_path, <span class="st">'src_id'</span>, <span class="st">'dst_id'</span>, <span class="st">'src_label'</span>, <span class="st">'dst_label'</span>)}`</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># return a very useful dictionary for various reclassification tasks:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="86052adc" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>return_dict <span class="op">=</span> {} return_dict[<span class="st">'dst_to_src_reclassification_dict'</span>] <span class="op">=</span> dst_to_src_reclassification_dict  <span class="co"># Dict of one-to-many keys to lists of what each dst_key should be mapped to from each src_key. Useful when aggrigating multiple layers to a aggregated dest type </span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>return_dict[<span class="st">'src_to_dst_reclassification_dict'</span>] <span class="op">=</span> src_to_dst_reclassification_dict <span class="co"># Useful when going to a specific value. </span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>return_dict[<span class="st">'dst_to_src_labels_dict'</span>] <span class="op">=</span> dst_to_src_labels_dict <span class="co"># Dictionary of lists of labels that map to each dst label </span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>return_dict[<span class="st">'src_ids'</span>] <span class="op">=</span> remove_duplicates_in_order(src_ids) <span class="co"># Unique set of src_ids r</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>return_dict[<span class="st">'dst_ids'</span>] <span class="op">=</span> remove_duplicates_in_order(dst_ids) <span class="co"># Unique set of dst_ids </span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>return_dict[<span class="st">'src_labels'</span>] <span class="op">=</span> remove_duplicates_in_order(src_labels) <span class="co"># Unique set of src_labels </span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>return_dict[<span class="st">'dst_labels'</span>] <span class="op">=</span> remove_duplicates_in_order(dst_labels) <span class="co"># Unique set of dst_labels </span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>return_dict[<span class="st">'src_ids_to_labels'</span>] <span class="op">=</span> {k: v <span class="cf">for</span> k, v <span class="kw">in</span> <span class="bu">zip</span>(return_dict[<span class="st">'src_ids'</span>], return_dict[<span class="st">'src_labels'</span>])} <span class="co"># one-to-one dictionary of src ids to labels </span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>return_dict[<span class="st">'dst_ids_to_labels'</span>] <span class="op">=</span> {k: v <span class="cf">for</span> k, v <span class="kw">in</span> <span class="bu">zip</span>(return_dict[<span class="st">'dst_ids'</span>], return_dict[<span class="st">'dst_labels'</span>])} <span class="co"># one-to-one dictionary of dst ids to labels </span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>return_dict[<span class="st">'src_labels_to_ids'</span>] <span class="op">=</span> {k: v <span class="cf">for</span> k, v <span class="kw">in</span> <span class="bu">zip</span>(return_dict[<span class="st">'src_labels'</span>], return_dict[<span class="st">'src_ids'</span>])} <span class="co"># one-to-one dictionary of src labels to ids </span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>return_dict[<span class="st">'dst_labels_to_ids'</span>] <span class="op">=</span> {k: v <span class="cf">for</span> k, v <span class="kw">in</span> <span class="bu">zip</span>(return_dict[<span class="st">'dst_labels'</span>], return_dict[<span class="st">'dst_ids'</span>])} <span class="co"># one-to-one dictionary of dst labels to ids}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Among other possibilities, this could be used for reclassifying LULC geotiffs via</p>
<div id="a1e93227" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>rules <span class="op">=</span> p.lulc_correspondence_dict[<span class="st">'src_to_dst_reclassification_dict'</span>] hb.reclassify_raster_hb(raster_path, rules, output_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="combined-ids" class="level3">
<h3 class="anchored" data-anchor-id="combined-ids">Combined ids</h3>
<p>One special case of ids is when two different ids are combined together leveraging their decimal position to compress data. For example, if you want a Region-AEZ-specific id stored in single column, you can do that by saying the joined id is 5 digits long, the first three correspond to ee_r264 and the final two correspond to aez18, as in this example:</p>
<p><img src="images/paste-29.png" class="img-fluid"></p>
<p>In the event of a combined id, not that the _id column above has two region-specifications combined (which otherwise violates the ee spec defined above for non combined ids).</p>
</section>
<section id="correspondences-with-geometries" class="level3">
<h3 class="anchored" data-anchor-id="correspondences-with-geometries">Correspondences with geometries</h3>
<div id="22efef85" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The rules for naming correspondences are a little different when adding geometry to the data. Because}     </span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># # only 1 geometry can be assigned per file, and becasue membership of aggregated regions and their     </span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # members can get confusing, each correspondence file keeps all the labels but then is also saved along     </span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # with a geometry file that drops the other labels (and the word correspondence in the filename).     </span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>p.ee_r264_correspondence_vector_path <span class="op">=</span> p.get_path(os.path.join(<span class="st">'gtap_invest'</span>, <span class="st">'region_boundaries'</span>, <span class="st">'ee_r264_correspondence.gpkg'</span>))     </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>p.ee_r264_vector_path <span class="op">=</span> p.get_path(os.path.join(<span class="st">'gtap_invest'</span>, <span class="st">'region_boundaries'</span>, <span class="st">'ee_r264.gpkg'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="more-on-naming-conventions" class="level3">
<h3 class="anchored" data-anchor-id="more-on-naming-conventions">More on naming Conventions</h3>
<p>The names of project-level variables are carefully defined. For example, in <code>gtapv7_r251_r160_correspondence_input_path</code>,</p>
<ul>
<li>The <code>input</code> when put right before the word path implies it is a raw asset we obtained from an external source but haven’t processed it yet. This means that it can be a non-compliant XLSX file. Aslo, path implies that it is a string type that points to a location in a storage device.</li>
<li>In this name, we see two other structures. First, the <code>gtapv7</code> label indicates the “domain” of the correspondence defined in all of the following dimensions (until another domain label). Above, this means that it is the 251 regions, as defined by the gtapv7 domain, mapped to the 160 regions in the same domain.</li>
</ul>
<p>You can have multiple mappings in a single correspondence file. For example, gtapv7_r251_s65_r50_s26_correspondence_input_path, we are mapping r251 to r50 and s (sectors) 65 to s26, all in the gtapv7 domain.</p>
<p>Appart from correspondence files, we also have <strong>labels</strong> files, such as gtapv7_r251_labels_path. Labels files are for a single set/variable/dimension but map together the synonymous categorizers. Specifically, it must have an id, label, and name, all filled out for every entry. It can optionally have others like description.</p>
<p>In the filename gtapv7_r251_labels_path we extract from the input_path and write a EE-compliant labels table for the gtapv7 r251 set. In the filename <code>gtap11_gtapaez11_region_correspondence_path</code>, we use these regions and then connect it to the gtapaez11 labels. We can infer also that it is from a mapping labeled gtap11 to gtapaez11 and that the variable in question is the regions while the word correspondence then indicates this is a many-to-one mapping file.</p>
<p>Note that the file path says “regions” while the column label in the CSV says “region”.</p>
<div id="0bcf0ad8" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>p.gtap11_region_correspondence_input_path <span class="op">=</span> os.path.join(p.base_data_dir, <span class="st">'gtappy'</span>, <span class="st">'aggregation_mappings'</span>, <span class="st">'GTAP-ctry2reg.xlsx'</span>)     </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>p.gtap11_region_names_path <span class="op">=</span> os.path.join(p.base_data_dir, <span class="st">'gtappy'</span>, <span class="st">'aggregation_mappings'</span>, <span class="st">'gtap11_region_names.csv'</span>)     </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>p.gtap11_gtapaez11_region_correspondence_path <span class="op">=</span> os.path.join(p.base_data_dir, <span class="st">'gtappy'</span>, <span class="st">'aggregation_mappings'</span>, <span class="st">'gtap11_gtapaez11_region_correspondance.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="variable-and-scenario-naming-conventions" class="level2">
<h2 class="anchored" data-anchor-id="variable-and-scenario-naming-conventions">Variable and Scenario Naming Conventions</h2>
<p>To keep track of the MANY different filetypes, data processes, variables, scenarios, policies etc, please follow exactly the specifications below.</p>
<ul>
<li><p>The word label refers to a relatively short string (preferably 8 characters long or less) with no spaces, underscores or punctuation (but may have hyphens). This is case-sensitive, but try to avoid capitalization.</p></li>
<li><p>The word short_label refers to a label that is strictly less or equal to 8 characters to ensure compatibility with HAR files.</p></li>
<li><p>The word name refers to a longer string that describes a specific label with a 1:1 correspondence. Will usually be defined via a correspondence dictionary.</p></li>
<li><p>The words index, indices or id refers to numerical data that describes a label with a 1:1 correspondence. Will usually be defined via a correspondence dictionary. If both are used, index/indices refer to a unique, ordered list of ints while an id/ids refer are unique but not necessarily ordered.</p></li>
<li><p>The word class refers to LULC class. Consider renaming this to lc-class?</p></li>
<li><p>Scenarios are defined in the following nested structure:</p>
<ul>
<li><p>Label (with no hyphens) for Exogenous Assumptions (e.g., which SSP, which GDP, which population). Typically this will be fully defined by the SSP.</p></li>
<li><p>Label (with no hyphens) for Climate Assumption (which RCP)</p></li>
<li><p>Label (can have hyphens) for which model is used (e.g., magpie, luh2-message). Only model is allowed to have hyphens (because they are used for multistep scenario processing of counterfactuals)</p></li>
<li><p>Label for Counterfactual. This often represent policy Assumptions/Definition and can include BAU, which is a special counterfactual against which other policies are compared. Different counterfactuals correspond to different shockfiles in the econ model or different LUC projection priorities, etc.</p>
<ul>
<li><p>Counterfactuals may have multiple processing steps, which will be denoted by appending a hyphen and exactly 4 chars to the end of the base counterfactual label.</p>
<ul>
<li>IFor example, a run excludes consideration of ES, insert “-noes”, at the end of the policy_name if it does include ES, postpend nothing (as this will be the one that is referenced by default)</li>
</ul></li>
</ul></li>
<li><p>Year</p>
<ul>
<li><p>When the variable is singular, it must be an int. If it is plural, as is ints in a list. However, when either is stored in a dataframe, always type always type check as follows:</p>
<ul>
<li><p>If singular, do str(value), int(value) or float(value) as appropriate when reading from the df into a python variable.</p></li>
<li><p>If plural, assume the df value is a space-delimited string that needs to be split, e.g.&nbsp;as [int(i) for i in value.split(’ ‘)], or’ ’.join(values) if going into the DF</p></li>
</ul></li>
<li><p>Three types of years exist, including</p>
<ul>
<li>p.base_years, (which recall will always be a list even if there is a single entry because the variable name is plural)</li>
</ul></li>
</ul></li>
</ul></li>
<li><p>Together, the labels above mean that the scenarios can be represented by directories as follows:</p>
<ul>
<li><code>ssp2/rcp45/luh2-message/bau/filename_2050.tif</code>
<ul>
<li>Note, the last layer of the hierarchy will be included as a the suffix of the filename start rather than as a directory (also see below for filename conventions)</li>
</ul></li>
</ul></li>
<li><p>For filenames, there are two possible conventions:</p>
<ul>
<li><p>Implied: This means that the directory structure above defines all the labels with the exception of year (which is postpended to the filename label) and the current variable name (such as lulc) which appears at the front of the filename.</p>
<ul>
<li>e.g., <code>project/intermediate/convert_netcdf/ssp2/rcp45/luh2-message/bau/lulc_2050.tif</code></li>
</ul></li>
<li><p>Explicit: Even if a file is in a directory which implies its labels, explicit file naming will always include each label (and the variable label stays in front of the filename), so the above example is:</p>
<ul>
<li><p><code>project/intermediate/convert_netcdf/ssp2/rcp45/luh2-message/bau/lulc_ssp2_rcp45_bau_luh2-message_2050.tif</code></p></li>
<li><p>And if there are no ES considered, it would be <code>project/intermediate/convert_netcdf/ssp2/rcp45/luh2-message/bau/lulc_ssp2_rcp45_bau_luh2-message_2050.tif</code></p></li>
</ul></li>
</ul></li>
<li><p>Because labels have no spaces or underscores, it is possible to convert the nested structure above to a single string, as in <code>filename_ssp2_rcp45_policyname_year.tif</code>.</p></li>
<li><p>Filetypes that supported in this computation environment include</p>
<ul>
<li><p>Netcdf with the above listed dimensions in the same order</p></li>
<li><p>A set of geotiffs embedded in directories. Each label gets a directory level expect for year, which by convention, will ALWAYS be the last 4 characters of a filename before the extension (with an underscore before it).</p></li>
<li><p>A spreadsheet linkable to a geographic representation (e.g., a shapefile or a geopackage) in vertical format</p></li>
</ul></li>
<li><p>Also we will create a set of tables to analyze results</p>
<ul>
<li><p>These will define Regions (<code>shp</code>) for quick result plotting</p></li>
<li><p>Specifically, we will have a full vertically stacked CSV of results, then for each Report Archetype we would output 1 minimal info CSV and the corresponding Figure.</p></li>
</ul></li>
<li><p>Miscellaneous:</p>
<ul>
<li>base_years is correct, never baseline_years (due to confusion between baseline and bau)</li>
</ul></li>
<li><p>Scenario types</p>
<ul>
<li>Three scenario_types are supported: baseline, bau and policy
<ul>
<li>Baseline assumes the year has data existing from observations (rather than modelled) and that these years are defined in p.years (and identically defined in <code>p.base_years</code>).
<ul>
<li>One exception is when eg GTAP is used to update the base year from 2017 to 2023, and then policies are applied on 2023.</li>
</ul></li>
<li>BAU and policy scenarios assume the results are modelled and that their years are defined in p.years (but not <code>p.base_years</code>)</li>
</ul></li>
<li>Clarify what is the naming difference between src dst versus input output. Is the former only for file paths or can it also be e.g.&nbsp;array. OR does this have to do with if it is a function return.
<ul>
<li>Proposed answer: src/dst is a pointer/reference to a thing and Input/Output is the thing itself. Esp useful for paths.</li>
<li>Similarly, _path and _dir imply the string is a reference, so src_path and src_dir are common.</li>
<li>You might often see e.g.&nbsp;<code>input_array = hb.as_array(src_path)</code>, illustrating this difference.</li>
</ul></li>
</ul></li>
<li></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>